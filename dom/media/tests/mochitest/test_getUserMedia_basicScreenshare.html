<
!
DOCTYPE
HTML
>
<
html
>
<
head
>
<
script
type
=
"
application
/
javascript
"
src
=
"
mediaStreamPlayback
.
js
"
>
<
/
script
>
<
/
head
>
<
body
>
<
pre
id
=
"
test
"
>
<
script
type
=
"
application
/
javascript
"
>
createHTML
(
{
title
:
"
getUserMedia
Basic
Screenshare
Test
"
bug
:
"
1211656
"
}
)
;
/
*
*
*
Run
a
test
to
verify
that
we
can
complete
a
start
and
stop
media
playback
*
cycle
for
a
screenshare
MediaStream
on
a
video
HTMLMediaElement
.
*
/
runTest
(
async
function
(
)
{
const
isWinXP
=
navigator
.
userAgent
.
indexOf
(
"
Windows
NT
5
.
1
"
)
!
=
-
1
;
if
(
IsMacOSX10_6orOlder
(
)
|
|
isWinXP
)
{
ok
(
true
"
Screensharing
disabled
for
OSX10
.
6
and
WinXP
"
)
;
return
;
}
let
testVideo
=
createMediaElement
(
'
video
'
'
testVideo
'
)
;
/
/
Screensharing
must
work
even
without
"
mochi
.
test
"
in
allowed_domains
await
pushPrefs
(
[
"
media
.
getusermedia
.
screensharing
.
allowed_domains
"
"
mozilla
.
github
.
io
*
.
bugzilla
.
mozilla
.
org
"
]
)
;
info
(
"
Testing
screenshare
without
constraints
"
)
;
let
stream
=
await
getUserMedia
(
{
video
:
{
mediaSource
:
"
screen
"
}
fake
:
false
}
)
;
let
playback
=
new
LocalMediaStreamPlayback
(
testVideo
stream
)
;
await
playback
.
playMediaWithDeprecatedStreamStop
(
false
)
;
info
(
"
Testing
screenshare
with
size
and
framerate
constraints
"
)
;
stream
=
await
getUserMedia
(
{
video
:
{
mediaSource
:
'
screen
'
width
:
{
min
:
'
10
'
max
:
'
100
'
}
height
:
{
min
:
'
10
'
max
:
'
100
'
}
frameRate
:
{
min
:
'
10
'
max
:
'
15
'
}
}
fake
:
false
}
)
;
playback
=
new
LocalMediaStreamPlayback
(
testVideo
stream
)
;
playback
.
startMedia
(
false
)
;
await
playback
.
verifyPlaying
(
)
;
info
(
"
Testing
modifying
screenshare
with
applyConstraints
"
)
;
await
Promise
.
all
(
[
(
)
=
>
testVideo
.
srcObject
.
getVideoTracks
(
)
[
0
]
.
applyConstraints
(
{
mediaSource
:
'
screen
'
width
:
200
height
:
200
frameRate
:
{
min
:
'
5
'
max
:
'
10
'
}
}
)
(
)
=
>
listenUntil
(
testVideo
"
resize
"
(
)
=
>
true
)
]
)
;
await
playback
.
verifyPlaying
(
)
;
/
/
still
playing
await
playback
.
deprecatedStopStreamInMediaPlayback
(
)
;
playback
.
detachFromMediaElement
(
)
;
}
)
;
<
/
script
>
<
/
pre
>
<
/
body
>
<
/
html
>
