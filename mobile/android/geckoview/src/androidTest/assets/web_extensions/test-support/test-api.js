/
*
This
Source
Code
Form
is
subject
to
the
terms
of
the
Mozilla
Public
*
License
v
.
2
.
0
.
If
a
copy
of
the
MPL
was
not
distributed
with
this
*
file
You
can
obtain
one
at
http
:
/
/
mozilla
.
org
/
MPL
/
2
.
0
/
.
*
/
"
use
strict
"
;
const
{
Preferences
}
=
ChromeUtils
.
import
(
"
resource
:
/
/
gre
/
modules
/
Preferences
.
jsm
"
)
;
this
.
test
=
class
extends
ExtensionAPI
{
getAPI
(
context
)
{
return
{
test
:
{
/
*
Set
prefs
and
returns
set
of
saved
prefs
*
/
async
setPrefs
(
oldPrefs
newPrefs
)
{
/
/
Save
old
prefs
Object
.
assign
(
oldPrefs
.
.
.
Object
.
keys
(
newPrefs
)
.
filter
(
key
=
>
!
(
key
in
oldPrefs
)
)
.
map
(
key
=
>
(
{
[
key
]
:
Preferences
.
get
(
key
null
)
}
)
)
)
;
/
/
Set
new
prefs
Preferences
.
set
(
newPrefs
)
;
return
oldPrefs
;
}
/
*
Restore
prefs
to
old
value
.
*
/
async
restorePrefs
(
oldPrefs
)
{
for
(
let
[
name
value
]
of
Object
.
entries
(
oldPrefs
)
)
{
if
(
value
=
=
=
null
)
{
Preferences
.
reset
(
name
)
;
}
else
{
Preferences
.
set
(
name
value
)
;
}
}
}
/
*
Get
pref
values
.
*
/
async
getPrefs
(
prefs
)
{
return
Preferences
.
get
(
prefs
)
;
}
}
}
;
}
}
;
