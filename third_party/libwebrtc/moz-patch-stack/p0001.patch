From
:
Daniel
Baker
<
dbaker
mozilla
.
com
>
Date
:
Mon
1
Dec
2025
19
:
31
:
22
-
0700
Subject
:
(
tmp
-
cherry
-
pick
)
[
M142
]
Revert
"
Add
instructions
for
removing
a
Trampoline
-
wrapped
Signal
"
(
29d6eabaf0
)
This
reverts
commit
bb6b3aab159ebcd825526cf831f54170ccb2584d
.
Reason
for
revert
:
Need
to
fix
downstream
Chromium
issues
.
Original
change
'
s
description
:
>
Add
instructions
for
removing
a
Trampoline
-
wrapped
Signal
>
>
Also
apply
the
instructions
to
one
Signal
.
>
>
Bug
:
webrtc
:
42222066
>
Change
-
Id
:
I63409d968d27a843b0ac7c61a122a1b685cb7a6f
>
Reviewed
-
on
:
https
:
/
/
webrtc
-
review
.
googlesource
.
com
/
c
/
src
/
+
/
408883
>
Reviewed
-
by
:
Tomas
Gunnarsson
<
tommi
webrtc
.
org
>
>
Commit
-
Queue
:
Harald
Alvestrand
<
hta
webrtc
.
org
>
>
Cr
-
Commit
-
Position
:
refs
/
heads
/
main
{
#
45624
}
(
cherry
picked
from
commit
716c8eb942a74ad641bbace8c1db521b4857c636
)
Bug
:
webrtc
:
42222066
chromium
:
449225599
chromium
:
450516559
No
-
IWYU
:
Revert
Change
-
Id
:
I7fdf1694664b11ffcfd91916f1e98ef88254059d
Reviewed
-
on
:
https
:
/
/
webrtc
-
review
.
googlesource
.
com
/
c
/
src
/
+
/
413923
Auto
-
Submit
:
Harald
Alvestrand
<
hta
webrtc
.
org
>
Commit
-
Queue
:
Harald
Alvestrand
<
hta
webrtc
.
org
>
Reviewed
-
by
:
Tomas
Gunnarsson
<
tommi
webrtc
.
org
>
Reviewed
-
by
:
Guido
Urdaneta
<
guidou
webrtc
.
org
>
Cr
-
Original
-
Commit
-
Position
:
refs
/
heads
/
main
{
#
45840
}
Reviewed
-
on
:
https
:
/
/
webrtc
-
review
.
googlesource
.
com
/
c
/
src
/
+
/
415743
Commit
-
Queue
:
Guido
Urdaneta
<
guidou
webrtc
.
org
>
Reviewed
-
by
:
Harald
Alvestrand
<
hta
webrtc
.
org
>
Cr
-
Commit
-
Position
:
refs
/
branch
-
heads
/
7444
{
#
2
}
Cr
-
Branched
-
From
:
f70dc714a073397356f6ed866481da73f90f0b96
-
refs
/
heads
/
main
{
#
45766
}
-
-
-
p2p
/
base
/
ice_transport_internal
.
cc
|
5
+
+
+
-
-
p2p
/
base
/
ice_transport_internal
.
h
|
9
+
+
+
+
+
+
-
-
-
rtc_base
/
sigslot_trampoline
.
h
|
12
-
-
-
-
-
-
-
-
-
-
-
-
3
files
changed
9
insertions
(
+
)
17
deletions
(
-
)
diff
-
-
git
a
/
p2p
/
base
/
ice_transport_internal
.
cc
b
/
p2p
/
base
/
ice_transport_internal
.
cc
index
7843a8b37d
.
.
a4b96db00b
100644
-
-
-
a
/
p2p
/
base
/
ice_transport_internal
.
cc
+
+
+
b
/
p2p
/
base
/
ice_transport_internal
.
cc
-
236
7
+
236
8
RTCError
IceConfig
:
:
IsValid
(
)
const
{
}
IceTransportInternal
:
:
IceTransportInternal
(
)
-
:
role_conflict_trampoline_
(
this
)
+
:
candidate_gathered_trampoline_
(
this
)
+
role_conflict_trampoline_
(
this
)
ice_transport_state_changed_trampoline_
(
this
)
destroyed_trampoline_
(
this
)
{
}
-
265
7
+
266
7
void
IceTransportInternal
:
:
RemoveGatheringStateCallback
(
void
IceTransportInternal
:
:
SubscribeCandidateGathered
(
absl
:
:
AnyInvocable
<
void
(
IceTransportInternal
*
const
Candidate
&
)
>
callback
)
{
-
candidate_gathered_callbacks_
.
AddReceiver
(
std
:
:
move
(
callback
)
)
;
+
candidate_gathered_trampoline_
.
Subscribe
(
std
:
:
move
(
callback
)
)
;
}
void
IceTransportInternal
:
:
SubscribeRoleConflict
(
diff
-
-
git
a
/
p2p
/
base
/
ice_transport_internal
.
h
b
/
p2p
/
base
/
ice_transport_internal
.
h
index
69b8214fe1
.
.
0e233df6a5
100644
-
-
-
a
/
p2p
/
base
/
ice_transport_internal
.
h
+
+
+
b
/
p2p
/
base
/
ice_transport_internal
.
h
-
352
9
+
352
11
class
RTC_EXPORT
IceTransportInternal
:
public
PacketTransportInternal
{
void
RemoveGatheringStateCallback
(
const
void
*
removal_tag
)
;
/
/
Handles
sending
and
receiving
of
candidates
.
+
sigslot
:
:
signal2
<
IceTransportInternal
*
const
Candidate
&
>
+
SignalCandidateGathered
;
void
NotifyCandidateGathered
(
IceTransportInternal
*
transport
const
Candidate
&
candidate
)
{
-
candidate_gathered_callbacks_
.
Send
(
transport
candidate
)
;
+
SignalCandidateGathered
(
transport
candidate
)
;
}
void
SubscribeCandidateGathered
(
absl
:
:
AnyInvocable
<
void
(
IceTransportInternal
*
const
Candidate
&
)
>
-
464
8
+
466
9
class
RTC_EXPORT
IceTransportInternal
:
public
PacketTransportInternal
{
candidate_pair_change_callback_
;
private
:
-
CallbackList
<
IceTransportInternal
*
const
Candidate
&
>
-
candidate_gathered_callbacks_
;
+
SignalTrampoline
<
IceTransportInternal
+
&
IceTransportInternal
:
:
SignalCandidateGathered
>
+
candidate_gathered_trampoline_
;
SignalTrampoline
<
IceTransportInternal
&
IceTransportInternal
:
:
SignalRoleConflict
>
role_conflict_trampoline_
;
diff
-
-
git
a
/
rtc_base
/
sigslot_trampoline
.
h
b
/
rtc_base
/
sigslot_trampoline
.
h
index
a399e4177f
.
.
590e73d97b
100644
-
-
-
a
/
rtc_base
/
sigslot_trampoline
.
h
+
+
+
b
/
rtc_base
/
sigslot_trampoline
.
h
-
51
18
+
51
6
namespace
webrtc
{
/
/
my_class_object
.
SubscibeMyNamedEvent
(
/
/
SafeInvocable
(
target
.
safety_flag_
.
flag
(
)
/
/
[
target
]
{
target
.
function
(
)
;
}
-
/
/
WHEN
REMOVING
THE
SIGNAL
-
/
/
Make
a
CL
that
will
:
-
/
/
-
Delete
the
SignalMyNamedEvent
signal
-
/
/
-
Change
my_named_event_trampoline_
to
my_named_event_callbacks
-
/
/
of
type
CallbackList
<
function
arguments
>
-
/
/
-
Change
SubscribeMyNamedEvent
to
call
my_named_event_callbacks
.
AddReceiver
-
/
/
-
Change
NotifyMyNamedEvent
to
call
my_named_event_callbacks_
.
Send
-
/
/
-
If
UnsubscribeMyNamedEvent
exists
change
that
also
.
-
/
/
-
Delete
the
initialization
of
my_named_event_trampoline_
from
the
-
/
/
relevant
constructor
.
-
/
/
Sending
this
through
the
bots
will
flush
out
remaining
references
to
-
/
/
SignalMyNamedEvent
.
namespace
internal
{
template
<
typename
MemberPtrT
>
struct
member_pointer_traits
;
