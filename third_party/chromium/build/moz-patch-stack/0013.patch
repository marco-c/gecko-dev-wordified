From
:
Michael
Froman
<
mfroman
mozilla
.
com
>
Date
:
Mon
20
Jun
2022
22
:
34
:
00
+
0000
Subject
:
Bug
1775143
-
pt18
-
(
mirror
)
(
cherry
-
pick
)
glandium
'
s
D149205
.
patch
r
=
ng
Depends
on
D149831
Differential
Revision
:
https
:
/
/
phabricator
.
services
.
mozilla
.
com
/
D149832
Mercurial
Revision
:
https
:
/
/
hg
.
mozilla
.
org
/
mozilla
-
central
/
rev
/
3a785d486d97fc9cb263eafb0fe8f2148fc0b101
-
-
-
config
/
BUILDCONFIG
.
gn
|
6
+
+
+
-
-
-
config
/
mac
/
mac_sdk
.
gni
|
6
+
+
+
-
-
-
config
/
rust
.
gni
|
4
+
+
-
-
config
/
win
/
visual_studio_version
.
gni
|
2
+
-
win
/
BUILD
.
gn
|
4
+
+
-
-
5
files
changed
11
insertions
(
+
)
11
deletions
(
-
)
diff
-
-
git
a
/
config
/
BUILDCONFIG
.
gn
b
/
config
/
BUILDCONFIG
.
gn
index
2883450e3
.
.
b6eb4be04
100644
-
-
-
a
/
config
/
BUILDCONFIG
.
gn
+
+
+
b
/
config
/
BUILDCONFIG
.
gn
-
233
7
+
233
7
if
(
host_toolchain
=
=
"
"
)
{
_default_toolchain
=
"
"
if
(
target_os
=
=
"
android
"
)
{
-
assert
(
host_os
=
=
"
linux
"
"
Android
builds
are
only
supported
on
Linux
.
"
)
+
#
assert
(
host_os
=
=
"
linux
"
"
Android
builds
are
only
supported
on
Linux
.
"
)
_default_toolchain
=
"
/
/
build
/
toolchain
/
android
:
android_clang_
target_cpu
"
}
else
if
(
target_os
=
=
"
chromeos
"
|
|
target_os
=
=
"
linux
"
|
|
target_os
=
=
"
openbsd
"
)
{
#
See
comments
in
build
/
toolchain
/
cros
/
BUILD
.
gn
about
board
compiles
.
-
247
8
+
247
8
if
(
target_os
=
=
"
android
"
)
{
}
else
if
(
target_os
=
=
"
ios
"
)
{
_default_toolchain
=
"
/
/
build
/
toolchain
/
ios
:
ios_clang_
target_cpu
"
}
else
if
(
target_os
=
=
"
mac
"
)
{
-
assert
(
host_os
=
=
"
mac
"
|
|
host_os
=
=
"
linux
"
-
"
Mac
cross
-
compiles
are
unsupported
.
"
)
+
#
assert
(
host_os
=
=
"
mac
"
|
|
host_os
=
=
"
linux
"
+
#
"
Mac
cross
-
compiles
are
unsupported
.
"
)
_default_toolchain
=
"
/
/
build
/
toolchain
/
mac
:
clang_
target_cpu
"
}
else
if
(
target_os
=
=
"
win
"
)
{
#
On
Windows
we
use
the
same
toolchain
for
host
and
target
by
default
.
diff
-
-
git
a
/
config
/
mac
/
mac_sdk
.
gni
b
/
config
/
mac
/
mac_sdk
.
gni
index
a7f315c30
.
.
396cb56a3
100644
-
-
-
a
/
config
/
mac
/
mac_sdk
.
gni
+
+
+
b
/
config
/
mac
/
mac_sdk
.
gni
-
95
9
+
95
9
if
(
use_system_xcode
&
&
(
use_goma
|
|
use_remoteexec
)
)
{
}
sdk_info_args
+
=
[
mac_sdk_name
]
-
_mac_sdk_result
=
exec_script
(
script_name
sdk_info_args
"
scope
"
)
-
xcode_version
=
_mac_sdk_result
.
xcode_version
-
xcode_build
=
_mac_sdk_result
.
xcode_build
+
#
_mac_sdk_result
=
exec_script
(
script_name
sdk_info_args
"
scope
"
)
+
#
xcode_version
=
_mac_sdk_result
.
xcode_version
+
#
xcode_build
=
_mac_sdk_result
.
xcode_build
if
(
mac_sdk_path
=
=
"
"
&
&
use_system_xcode
&
&
(
use_goma
|
|
use_remoteexec
)
)
{
mac_sdk_path
=
_mac_sdk_result
.
sdk_path
}
diff
-
-
git
a
/
config
/
rust
.
gni
b
/
config
/
rust
.
gni
index
9e3973d68
.
.
4ef6e549f
100644
-
-
-
a
/
config
/
rust
.
gni
+
+
+
b
/
config
/
rust
.
gni
-
131
8
+
131
8
if
(
enable_rust
)
{
use_unverified_rust_toolchain
=
false
}
else
{
if
(
host_os
!
=
"
linux
"
)
{
-
assert
(
false
-
"
Attempt
to
use
Android
Rust
toolchain
on
an
unsupported
platform
"
)
+
#
assert
(
false
+
#
"
Attempt
to
use
Android
Rust
toolchain
on
an
unsupported
platform
"
)
}
rust_sysroot
=
"
/
/
third_party
/
android_rust_toolchain
/
toolchain
"
diff
-
-
git
a
/
config
/
win
/
visual_studio_version
.
gni
b
/
config
/
win
/
visual_studio_version
.
gni
index
1da479dd5
.
.
8bb39c987
100644
-
-
-
a
/
config
/
win
/
visual_studio_version
.
gni
+
+
+
b
/
config
/
win
/
visual_studio_version
.
gni
-
40
5
+
40
5
if
(
visual_studio_path
=
=
"
"
)
{
"
You
must
set
the
windows_sdk_version
if
you
set
the
path
"
)
assert
(
wdk_path
!
=
"
"
"
You
must
set
the
wdk_path
if
you
set
the
visual
studio
path
"
)
-
visual_studio_runtime_dirs
=
[
]
+
visual_studio_runtime_dirs
=
"
"
}
diff
-
-
git
a
/
win
/
BUILD
.
gn
b
/
win
/
BUILD
.
gn
index
4abe95713
.
.
14c2527bc
100644
-
-
-
a
/
win
/
BUILD
.
gn
+
+
+
b
/
win
/
BUILD
.
gn
-
19
8
+
19
8
windows_manifest
(
"
default_exe_manifest
"
)
{
build_with_mozilla
=
false
if
(
is_win
&
&
!
build_with_mozilla
)
{
-
assert
(
host_os
!
=
"
mac
"
|
|
target_cpu
!
=
"
x86
"
-
"
Windows
cross
-
builds
from
Mac
must
be
64
-
bit
.
"
)
+
#
assert
(
host_os
!
=
"
mac
"
|
|
target_cpu
!
=
"
x86
"
+
#
"
Windows
cross
-
builds
from
Mac
must
be
64
-
bit
.
"
)
action
(
"
copy_cdb_to_output
"
)
{
script
=
"
/
/
build
/
win
/
copy_cdb_to_output
.
py
"
