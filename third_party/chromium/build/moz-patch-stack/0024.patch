From
:
Michael
Froman
<
mfroman
mozilla
.
com
>
Date
:
Tue
1
Jul
2025
18
:
07
:
09
-
0500
Subject
:
Bug
1775143
-
pt14
-
(
mirror
)
58f47eacaf10
r
=
ng
Search
third_party
/
libwebrtc
/
build
for
current_cpu
removing
third_party
/
libwebrtc
/
build
/
config
/
BUILDCONFIG
.
gn
and
third_party
/
libwebrtc
/
build
/
config
/
v8_target_cpu
.
gni
from
the
list
.
ack
-
lw
current_cpu
third_party
/
libwebrtc
/
build
|
grep
-
v
"
BUILDCONFIG
\
.
gn
"
|
grep
-
v
"
v8_target_cpu
\
.
gni
"
That
gave
me
this
:
sed
-
i
'
s
/
current_cpu
/
target_cpu
/
g
'
third_party
/
libwebrtc
/
build
/
config
/
android
/
abi
.
gni
sed
-
i
'
s
/
current_cpu
/
target_cpu
/
g
'
third_party
/
libwebrtc
/
build
/
config
/
android
/
BUILD
.
gn
sed
-
i
'
s
/
current_cpu
/
target_cpu
/
g
'
third_party
/
libwebrtc
/
build
/
config
/
android
/
config
.
gni
sed
-
i
'
s
/
current_cpu
/
target_cpu
/
g
'
third_party
/
libwebrtc
/
build
/
config
/
android
/
rules
.
gni
sed
-
i
'
s
/
current_cpu
/
target_cpu
/
g
'
third_party
/
libwebrtc
/
build
/
config
/
arm
.
gni
sed
-
i
'
s
/
current_cpu
/
target_cpu
/
g
'
third_party
/
libwebrtc
/
build
/
config
/
BUILD
.
gn
sed
-
i
'
s
/
current_cpu
/
target_cpu
/
g
'
third_party
/
libwebrtc
/
build
/
config
/
chromecast
/
BUILD
.
gn
sed
-
i
'
s
/
current_cpu
/
target_cpu
/
g
'
third_party
/
libwebrtc
/
build
/
config
/
chromeos
/
BUILD
.
gn
sed
-
i
'
s
/
current_cpu
/
target_cpu
/
g
'
third_party
/
libwebrtc
/
build
/
config
/
compiler
/
BUILD
.
gn
sed
-
i
'
s
/
current_cpu
/
target_cpu
/
g
'
third_party
/
libwebrtc
/
build
/
config
/
compiler
/
compiler
.
gni
sed
-
i
'
s
/
current_cpu
/
target_cpu
/
g
'
third_party
/
libwebrtc
/
build
/
config
/
ios
/
BUILD
.
gn
sed
-
i
'
s
/
current_cpu
/
target_cpu
/
g
'
third_party
/
libwebrtc
/
build
/
config
/
ios
/
config
.
gni
sed
-
i
'
s
/
current_cpu
/
target_cpu
/
g
'
third_party
/
libwebrtc
/
build
/
config
/
ios
/
rules
.
gni
sed
-
i
'
s
/
current_cpu
/
target_cpu
/
g
'
third_party
/
libwebrtc
/
build
/
config
/
linux
/
BUILD
.
gn
sed
-
i
'
s
/
current_cpu
/
target_cpu
/
g
'
third_party
/
libwebrtc
/
build
/
config
/
linux
/
pkg_config
.
gni
sed
-
i
'
s
/
current_cpu
/
target_cpu
/
g
'
third_party
/
libwebrtc
/
build
/
config
/
mac
/
BUILD
.
gn
sed
-
i
'
s
/
current_cpu
/
target_cpu
/
g
'
third_party
/
libwebrtc
/
build
/
config
/
mips
.
gni
sed
-
i
'
s
/
current_cpu
/
target_cpu
/
g
'
third_party
/
libwebrtc
/
build
/
config
/
nacl
/
BUILD
.
gn
sed
-
i
'
s
/
current_cpu
/
target_cpu
/
g
'
third_party
/
libwebrtc
/
build
/
config
/
nacl
/
config
.
gni
sed
-
i
'
s
/
current_cpu
/
target_cpu
/
g
'
third_party
/
libwebrtc
/
build
/
config
/
nacl
/
rules
.
gni
sed
-
i
'
s
/
current_cpu
/
target_cpu
/
g
'
third_party
/
libwebrtc
/
build
/
config
/
posix
/
BUILD
.
gn
sed
-
i
'
s
/
current_cpu
/
target_cpu
/
g
'
third_party
/
libwebrtc
/
build
/
config
/
rust
.
gni
sed
-
i
'
s
/
current_cpu
/
target_cpu
/
g
'
third_party
/
libwebrtc
/
build
/
config
/
sanitizers
/
BUILD
.
gn
sed
-
i
'
s
/
current_cpu
/
target_cpu
/
g
'
third_party
/
libwebrtc
/
build
/
config
/
sanitizers
/
sanitizers
.
gni
sed
-
i
'
s
/
current_cpu
/
target_cpu
/
g
'
third_party
/
libwebrtc
/
build
/
config
/
sysroot
.
gni
sed
-
i
'
s
/
current_cpu
/
target_cpu
/
g
'
third_party
/
libwebrtc
/
build
/
config
/
win
/
BUILD
.
gn
sed
-
i
'
s
/
current_cpu
/
target_cpu
/
g
'
third_party
/
libwebrtc
/
build
/
config
/
x64
.
gni
sed
-
i
'
s
/
current_cpu
/
target_cpu
/
g
'
third_party
/
libwebrtc
/
build
/
linux
/
extract_symbols
.
gni
sed
-
i
'
s
/
current_cpu
/
target_cpu
/
g
'
third_party
/
libwebrtc
/
build
/
toolchain
/
aix
/
BUILD
.
gn
sed
-
i
'
s
/
current_cpu
/
target_cpu
/
g
'
third_party
/
libwebrtc
/
build
/
toolchain
/
android
/
BUILD
.
gn
sed
-
i
'
s
/
current_cpu
/
target_cpu
/
g
'
third_party
/
libwebrtc
/
build
/
toolchain
/
cros
/
BUILD
.
gn
sed
-
i
'
s
/
current_cpu
/
target_cpu
/
g
'
third_party
/
libwebrtc
/
build
/
toolchain
/
fuchsia
/
BUILD
.
gn
sed
-
i
'
s
/
current_cpu
/
target_cpu
/
g
'
third_party
/
libwebrtc
/
build
/
toolchain
/
gcc_toolchain
.
gni
sed
-
i
'
s
/
current_cpu
/
target_cpu
/
g
'
third_party
/
libwebrtc
/
build
/
toolchain
/
ios
/
BUILD
.
gn
sed
-
i
'
s
/
current_cpu
/
target_cpu
/
g
'
third_party
/
libwebrtc
/
build
/
toolchain
/
linux
/
BUILD
.
gn
sed
-
i
'
s
/
current_cpu
/
target_cpu
/
g
'
third_party
/
libwebrtc
/
build
/
toolchain
/
linux
/
unbundle
/
BUILD
.
gn
sed
-
i
'
s
/
current_cpu
/
target_cpu
/
g
'
third_party
/
libwebrtc
/
build
/
toolchain
/
mac
/
BUILD
.
gn
sed
-
i
'
s
/
current_cpu
/
target_cpu
/
g
'
third_party
/
libwebrtc
/
build
/
toolchain
/
nacl
/
BUILD
.
gn
sed
-
i
'
s
/
current_cpu
/
target_cpu
/
g
'
third_party
/
libwebrtc
/
build
/
toolchain
/
win
/
BUILD
.
gn
sed
-
i
'
s
/
current_cpu
/
target_cpu
/
g
'
third_party
/
libwebrtc
/
build
/
toolchain
/
win
/
midl
.
gni
sed
-
i
'
s
/
current_cpu
/
target_cpu
/
g
'
third_party
/
libwebrtc
/
build
/
toolchain
/
zos
/
BUILD
.
gn
sed
-
i
'
s
/
current_cpu
/
target_cpu
/
g
'
third_party
/
libwebrtc
/
build
/
win
/
BUILD
.
gn
sed
-
i
'
s
/
current_cpu
/
target_cpu
/
g
'
third_party
/
libwebrtc
/
build
/
win
/
message_compiler
.
gni
(
skip
-
generation
)
Depends
on
D149827
Differential
Revision
:
https
:
/
/
phabricator
.
services
.
mozilla
.
com
/
D149828
Mercurial
Revision
:
https
:
/
/
hg
.
mozilla
.
org
/
mozilla
-
central
/
rev
/
ec13234e5a641a026e946425ddea2d0de86435cd
-
-
-
config
/
BUILD
.
gn
|
2
+
-
config
/
android
/
BUILD
.
gn
|
10
+
+
-
-
config
/
android
/
abi
.
gni
|
14
+
+
+
-
-
-
config
/
android
/
config
.
gni
|
12
+
+
-
-
-
config
/
android
/
rules
.
gni
|
6
+
-
-
config
/
arm
.
gni
|
6
+
-
-
config
/
chromecast
/
BUILD
.
gn
|
4
+
-
config
/
chromeos
/
BUILD
.
gn
|
8
+
-
-
config
/
compiler
/
BUILD
.
gn
|
70
+
+
+
+
+
+
+
+
+
+
+
+
+
-
-
-
-
-
-
-
-
-
-
-
-
-
config
/
compiler
/
compiler
.
gni
|
32
+
+
+
+
+
+
-
-
-
-
-
-
config
/
ios
/
BUILD
.
gn
|
12
+
+
-
-
-
config
/
ios
/
config
.
gni
|
2
+
-
config
/
ios
/
rules
.
gni
|
8
+
-
-
config
/
linux
/
BUILD
.
gn
|
4
+
-
config
/
linux
/
pkg_config
.
gni
|
2
+
-
config
/
mac
/
BUILD
.
gn
|
10
+
+
-
-
config
/
mips
.
gni
|
10
+
+
-
-
config
/
nacl
/
BUILD
.
gn
|
6
+
-
-
config
/
nacl
/
config
.
gni
|
12
+
+
-
-
-
config
/
nacl
/
rules
.
gni
|
16
+
+
+
-
-
-
config
/
posix
/
BUILD
.
gn
|
2
+
-
config
/
rust
.
gni
|
20
+
+
+
+
-
-
-
-
config
/
sanitizers
/
BUILD
.
gn
|
20
+
+
+
+
-
-
-
-
config
/
sanitizers
/
sanitizers
.
gni
|
4
+
-
config
/
sysroot
.
gni
|
26
+
+
+
+
+
-
-
-
-
-
config
/
win
/
BUILD
.
gn
|
30
+
+
+
+
+
-
-
-
-
-
-
config
/
x64
.
gni
|
4
+
-
linux
/
extract_symbols
.
gni
|
2
+
-
toolchain
/
aix
/
BUILD
.
gn
|
2
+
-
toolchain
/
android
/
BUILD
.
gn
|
14
+
+
+
-
-
-
toolchain
/
cros
/
BUILD
.
gn
|
14
+
+
+
-
-
-
toolchain
/
fuchsia
/
BUILD
.
gn
|
4
+
-
toolchain
/
gcc_toolchain
.
gni
|
8
+
-
-
toolchain
/
ios
/
BUILD
.
gn
|
18
+
+
+
-
-
-
-
toolchain
/
linux
/
BUILD
.
gn
|
82
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
toolchain
/
linux
/
unbundle
/
BUILD
.
gn
|
4
+
-
toolchain
/
mac
/
BUILD
.
gn
|
38
+
+
+
+
+
+
+
-
-
-
-
-
-
-
toolchain
/
nacl
/
BUILD
.
gn
|
8
+
-
-
toolchain
/
win
/
BUILD
.
gn
|
16
+
+
+
-
-
-
toolchain
/
win
/
midl
.
gni
|
6
+
-
-
toolchain
/
zos
/
BUILD
.
gn
|
2
+
-
win
/
BUILD
.
gn
|
8
+
-
-
win
/
message_compiler
.
gni
|
2
+
-
43
files
changed
290
insertions
(
+
)
290
deletions
(
-
)
diff
-
-
git
a
/
config
/
BUILD
.
gn
b
/
config
/
BUILD
.
gn
index
30a2462dd
.
.
7e7c6c204
100644
-
-
-
a
/
config
/
BUILD
.
gn
+
+
+
b
/
config
/
BUILD
.
gn
-
122
7
+
122
7
config
(
"
debug
"
)
{
#
builds
and
we
have
to
tell
it
to
turn
it
off
.
defines
+
=
[
"
_HAS_ITERATOR_DEBUGGING
=
0
"
]
}
-
}
else
if
(
(
is_linux
|
|
is_chromeos
)
&
&
current_cpu
=
=
"
x64
"
&
&
+
}
else
if
(
(
is_linux
|
|
is_chromeos
)
&
&
target_cpu
=
=
"
x64
"
&
&
enable_iterator_debugging
)
{
#
Enable
libstdc
+
+
debugging
facilities
to
help
catch
problems
early
see
#
http
:
/
/
crbug
.
com
/
65151
.
diff
-
-
git
a
/
config
/
android
/
BUILD
.
gn
b
/
config
/
android
/
BUILD
.
gn
index
37e6ca554
.
.
0e25733fb
100644
-
-
-
a
/
config
/
android
/
BUILD
.
gn
+
+
+
b
/
config
/
android
/
BUILD
.
gn
-
33
7
+
33
7
config
(
"
compiler
"
)
{
"
ANDROID_NDK_VERSION_ROLL
=
{
android_ndk_version
}
_1
"
]
-
if
(
current_cpu
=
=
"
mips64el
"
)
{
+
if
(
target_cpu
=
=
"
mips64el
"
)
{
cflags
+
=
[
#
Have
to
force
IAS
for
mips64
.
"
-
fintegrated
-
as
"
-
47
7
+
47
7
config
(
"
compiler
"
)
{
"
-
Wl
-
-
exclude
-
libs
=
libvpx_assembly_arm
.
a
"
]
-
if
(
current_cpu
=
=
"
arm64
"
)
{
+
if
(
target_cpu
=
=
"
arm64
"
)
{
if
(
arm_control_flow_integrity
=
=
"
standard
"
)
{
cflags
+
=
[
"
-
mbranch
-
protection
=
standard
"
]
}
else
if
(
arm_control_flow_integrity
=
=
"
pac
"
)
{
-
83
17
+
83
17
config
(
"
runtime_library
"
)
{
libs
=
[
]
ldflags
=
[
]
-
if
(
current_cpu
=
=
"
arm
"
&
&
arm_version
=
=
6
)
{
+
if
(
target_cpu
=
=
"
arm
"
&
&
arm_version
=
=
6
)
{
libs
+
=
[
"
atomic
"
]
}
-
if
(
current_cpu
=
=
"
mipsel
"
)
{
+
if
(
target_cpu
=
=
"
mipsel
"
)
{
libs
+
=
[
"
atomic
"
]
}
#
TODO
(
jdduke
)
Re
-
enable
on
mips
after
resolving
linking
#
issues
with
libc
+
+
(
crbug
.
com
/
456380
)
.
-
if
(
current_cpu
!
=
"
mipsel
"
&
&
current_cpu
!
=
"
mips64el
"
)
{
+
if
(
target_cpu
!
=
"
mipsel
"
&
&
target_cpu
!
=
"
mips64el
"
)
{
ldflags
+
=
[
"
-
Wl
-
-
warn
-
shared
-
textrel
"
]
}
}
diff
-
-
git
a
/
config
/
android
/
abi
.
gni
b
/
config
/
android
/
abi
.
gni
index
c2455baac
.
.
364a06b29
100644
-
-
-
a
/
config
/
android
/
abi
.
gni
+
+
+
b
/
config
/
android
/
abi
.
gni
-
41
10
+
41
10
assert
(
!
devtools_instrumentation_dumping
|
|
use_order_profiling
assert
(
!
use_call_graph
|
|
use_order_profiling
"
use_call_graph
requires
use_order_profiling
"
)
-
if
(
current_cpu
=
=
"
x86
"
)
{
+
if
(
target_cpu
=
=
"
x86
"
)
{
android_app_abi
=
"
x86
"
android_abi_target
=
"
i686
-
linux
-
android
"
-
}
else
if
(
current_cpu
=
=
"
arm
"
)
{
+
}
else
if
(
target_cpu
=
=
"
arm
"
)
{
import
(
"
/
/
chromium
/
build
/
config
/
arm
.
gni
"
)
if
(
arm_version
<
7
)
{
android_app_abi
=
"
armeabi
"
-
52
25
+
52
25
if
(
current_cpu
=
=
"
x86
"
)
{
android_app_abi
=
"
armeabi
-
v7a
"
}
android_abi_target
=
"
arm
-
linux
-
androideabi
"
-
}
else
if
(
current_cpu
=
=
"
mipsel
"
)
{
+
}
else
if
(
target_cpu
=
=
"
mipsel
"
)
{
android_app_abi
=
"
mips
"
android_abi_target
=
"
mipsel
-
linux
-
android
"
-
}
else
if
(
current_cpu
=
=
"
x64
"
)
{
+
}
else
if
(
target_cpu
=
=
"
x64
"
)
{
android_app_abi
=
"
x86_64
"
#
Place
holder
for
x64
support
not
tested
.
#
TODO
:
Enable
clang
support
for
Android
x64
.
http
:
/
/
crbug
.
com
/
539781
android_abi_target
=
"
x86_64
-
linux
-
android
"
-
}
else
if
(
current_cpu
=
=
"
arm64
"
)
{
+
}
else
if
(
target_cpu
=
=
"
arm64
"
)
{
android_app_abi
=
"
arm64
-
v8a
"
android_abi_target
=
"
aarch64
-
linux
-
android
"
-
}
else
if
(
current_cpu
=
=
"
mips64el
"
)
{
+
}
else
if
(
target_cpu
=
=
"
mips64el
"
)
{
android_app_abi
=
"
mips64
"
#
Place
holder
for
mips64
support
not
tested
.
android_abi_target
=
"
mips64el
-
linux
-
android
"
}
else
{
-
assert
(
false
"
Unknown
Android
ABI
:
"
+
current_cpu
)
+
assert
(
false
"
Unknown
Android
ABI
:
"
+
target_cpu
)
}
if
(
target_cpu
=
=
"
arm64
"
|
|
target_cpu
=
=
"
x64
"
|
|
target_cpu
=
=
"
mips64el
"
)
{
diff
-
-
git
a
/
config
/
android
/
config
.
gni
b
/
config
/
android
/
config
.
gni
index
ab17b2c1b
.
.
01605a2eb
100644
-
-
-
a
/
config
/
android
/
config
.
gni
+
+
+
b
/
config
/
android
/
config
.
gni
-
332
17
+
332
17
if
(
is_android
|
|
is_chromeos
)
{
#
Location
of
libgcc
.
This
is
only
needed
for
the
current
GN
toolchain
so
we
#
only
need
to
define
the
current
one
rather
than
one
for
every
platform
#
like
the
toolchain
roots
.
-
if
(
current_cpu
=
=
"
x86
"
)
{
+
if
(
target_cpu
=
=
"
x86
"
)
{
android_prebuilt_arch
=
"
android
-
x86
"
-
}
else
if
(
current_cpu
=
=
"
arm
"
)
{
+
}
else
if
(
target_cpu
=
=
"
arm
"
)
{
android_prebuilt_arch
=
"
android
-
arm
"
-
}
else
if
(
current_cpu
=
=
"
mipsel
"
)
{
+
}
else
if
(
target_cpu
=
=
"
mipsel
"
)
{
android_prebuilt_arch
=
"
android
-
mips
"
-
}
else
if
(
current_cpu
=
=
"
x64
"
)
{
+
}
else
if
(
target_cpu
=
=
"
x64
"
)
{
android_prebuilt_arch
=
"
android
-
x86_64
"
-
}
else
if
(
current_cpu
=
=
"
arm64
"
)
{
+
}
else
if
(
target_cpu
=
=
"
arm64
"
)
{
android_prebuilt_arch
=
"
android
-
arm64
"
-
}
else
if
(
current_cpu
=
=
"
mips64el
"
)
{
+
}
else
if
(
target_cpu
=
=
"
mips64el
"
)
{
android_prebuilt_arch
=
"
android
-
mips64
"
}
else
{
assert
(
false
"
Need
android
libgcc
support
for
your
target
arch
.
"
)
diff
-
-
git
a
/
config
/
android
/
rules
.
gni
b
/
config
/
android
/
rules
.
gni
index
e5de9222d
.
.
08feb9c6d
100644
-
-
-
a
/
config
/
android
/
rules
.
gni
+
+
+
b
/
config
/
android
/
rules
.
gni
-
703
11
+
703
11
if
(
enable_java_templates
)
{
#
variables
must
not
be
set
.
template
(
"
write_native_libraries_java
"
)
{
_native_libraries_file
=
"
target_gen_dir
/
target_name
.
srcjar
"
-
if
(
current_cpu
=
=
"
arm
"
|
|
current_cpu
=
=
"
arm64
"
)
{
+
if
(
target_cpu
=
=
"
arm
"
|
|
target_cpu
=
=
"
arm64
"
)
{
_cpu_family
=
"
CPU_FAMILY_ARM
"
-
}
else
if
(
current_cpu
=
=
"
x86
"
|
|
current_cpu
=
=
"
x64
"
)
{
+
}
else
if
(
target_cpu
=
=
"
x86
"
|
|
target_cpu
=
=
"
x64
"
)
{
_cpu_family
=
"
CPU_FAMILY_X86
"
-
}
else
if
(
current_cpu
=
=
"
mipsel
"
|
|
current_cpu
=
=
"
mips64el
"
)
{
+
}
else
if
(
target_cpu
=
=
"
mipsel
"
|
|
target_cpu
=
=
"
mips64el
"
)
{
_cpu_family
=
"
CPU_FAMILY_MIPS
"
}
else
{
assert
(
false
"
Unsupported
CPU
family
"
)
diff
-
-
git
a
/
config
/
arm
.
gni
b
/
config
/
arm
.
gni
index
b3267c86b
.
.
59708c4f4
100644
-
-
-
a
/
config
/
arm
.
gni
+
+
+
b
/
config
/
arm
.
gni
-
4
11
+
4
11
import
(
"
/
/
chromium
/
build
/
config
/
v8_target_cpu
.
gni
"
)
-
#
These
are
primarily
relevant
in
current_cpu
=
=
"
arm
"
contexts
where
+
#
These
are
primarily
relevant
in
target_cpu
=
=
"
arm
"
contexts
where
#
ARM
code
is
being
compiled
.
But
they
can
also
be
relevant
in
the
#
other
contexts
when
the
code
will
change
its
behavior
based
on
the
#
cpu
it
wants
to
generate
code
for
.
-
if
(
current_cpu
=
=
"
arm
"
|
|
v8_current_cpu
=
=
"
arm
"
)
{
+
if
(
target_cpu
=
=
"
arm
"
|
|
v8_target_cpu
=
=
"
arm
"
)
{
declare_args
(
)
{
#
Version
of
the
ARM
processor
when
compiling
on
ARM
.
Ignored
on
non
-
ARM
#
platforms
.
-
120
7
+
120
7
if
(
current_cpu
=
=
"
arm
"
|
|
v8_current_cpu
=
=
"
arm
"
)
{
}
}
}
-
}
else
if
(
current_cpu
=
=
"
arm64
"
|
|
v8_current_cpu
=
=
"
arm64
"
)
{
+
}
else
if
(
target_cpu
=
=
"
arm64
"
|
|
v8_target_cpu
=
=
"
arm64
"
)
{
#
arm64
supports
only
"
hard
"
.
arm_float_abi
=
"
hard
"
arm_use_neon
=
true
diff
-
-
git
a
/
config
/
chromecast
/
BUILD
.
gn
b
/
config
/
chromecast
/
BUILD
.
gn
index
a20dcfbe4
.
.
173ba1bca
100644
-
-
-
a
/
config
/
chromecast
/
BUILD
.
gn
+
+
+
b
/
config
/
chromecast
/
BUILD
.
gn
-
61
7
+
61
7
config
(
"
ldconfig
"
)
{
config
(
"
executable_config
"
)
{
configs
=
[
"
:
ldconfig
"
]
-
if
(
!
is_clang
&
&
current_cpu
=
=
"
arm
"
)
{
+
if
(
!
is_clang
&
&
target_cpu
=
=
"
arm
"
)
{
ldflags
=
[
#
Export
stdlibc
+
+
and
libgcc
symbols
to
force
shlibs
to
refer
to
these
#
symbols
from
the
executable
.
-
89
7
+
89
7
config
(
"
executable_config
"
)
{
#
shared
libs
to
inherit
RPATH
from
the
parent
executable
that
is
loading
#
the
shared
library
.
(
See
internal
b
/
37514052
for
more
details
.
)
config
(
"
shared_library_config
"
)
{
-
if
(
current_cpu
=
=
"
arm
"
)
{
+
if
(
target_cpu
=
=
"
arm
"
)
{
configs
=
[
"
:
static_config
"
]
}
}
diff
-
-
git
a
/
config
/
chromeos
/
BUILD
.
gn
b
/
config
/
chromeos
/
BUILD
.
gn
index
5431d03dc
.
.
2c0e57589
100644
-
-
-
a
/
config
/
chromeos
/
BUILD
.
gn
+
+
+
b
/
config
/
chromeos
/
BUILD
.
gn
-
29
17
+
29
17
config
(
"
compiler
"
)
{
#
Non
-
Lacros
Chrome
OS
builds
use
per
-
board
toolchains
which
might
use
#
differen
triples
.
So
don
'
t
do
this
there
.
if
(
is_chromeos_device
&
&
is_chromeos_lacros
)
{
-
if
(
current_cpu
=
=
"
x64
"
)
{
+
if
(
target_cpu
=
=
"
x64
"
)
{
cflags
=
[
"
-
-
target
=
x86_64
-
cros
-
linux
-
gnu
"
]
ldflags
=
[
"
-
-
target
=
x86_64
-
cros
-
linux
-
gnu
"
]
-
}
else
if
(
current_cpu
=
=
"
arm
"
)
{
+
}
else
if
(
target_cpu
=
=
"
arm
"
)
{
cflags
=
[
"
-
-
target
=
armv7a
-
cros
-
linux
-
gnueabihf
"
]
ldflags
=
[
"
-
-
target
=
armv7a
-
cros
-
linux
-
gnueabihf
"
]
-
}
else
if
(
current_cpu
=
=
"
arm64
"
)
{
+
}
else
if
(
target_cpu
=
=
"
arm64
"
)
{
cflags
=
[
"
-
-
target
=
aarch64
-
cros
-
linux
-
gnu
"
]
ldflags
=
[
"
-
-
target
=
aarch64
-
cros
-
linux
-
gnu
"
]
}
else
{
-
assert
(
false
"
add
support
for
current_cpu
here
"
)
+
assert
(
false
"
add
support
for
target_cpu
here
"
)
}
}
}
diff
-
-
git
a
/
config
/
compiler
/
BUILD
.
gn
b
/
config
/
compiler
/
BUILD
.
gn
index
4d86abc51
.
.
44298f4f0
100644
-
-
-
a
/
config
/
compiler
/
BUILD
.
gn
+
+
+
b
/
config
/
compiler
/
BUILD
.
gn
-
24
14
+
24
14
import
(
"
/
/
chromium
/
build
/
toolchain
/
rbe
.
gni
"
)
import
(
"
/
/
chromium
/
build
/
toolchain
/
toolchain
.
gni
"
)
import
(
"
/
/
build_overrides
/
build
.
gni
"
)
-
if
(
current_cpu
=
=
"
arm
"
|
|
current_cpu
=
=
"
arm64
"
)
{
+
if
(
target_cpu
=
=
"
arm
"
|
|
target_cpu
=
=
"
arm64
"
)
{
import
(
"
/
/
chromium
/
build
/
config
/
arm
.
gni
"
)
}
-
if
(
current_cpu
=
=
"
mipsel
"
|
|
current_cpu
=
=
"
mips64el
"
|
|
-
current_cpu
=
=
"
mips
"
|
|
current_cpu
=
=
"
mips64
"
)
{
+
if
(
target_cpu
=
=
"
mipsel
"
|
|
target_cpu
=
=
"
mips64el
"
|
|
+
target_cpu
=
=
"
mips
"
|
|
target_cpu
=
=
"
mips64
"
)
{
import
(
"
/
/
chromium
/
build
/
config
/
mips
.
gni
"
)
}
-
if
(
current_cpu
=
=
"
x64
"
)
{
+
if
(
target_cpu
=
=
"
x64
"
)
{
import
(
"
/
/
chromium
/
build
/
config
/
x64
.
gni
"
)
}
if
(
is_mac
)
{
-
195
8
+
195
8
declare_args
(
)
{
(
is_posix
|
|
is_fuchsia
)
&
&
!
is_debug
&
&
!
using_sanitizer
&
&
!
use_clang_coverage
&
&
current_os
!
=
"
zos
"
&
&
!
(
is_android
&
&
use_order_profiling
)
&
&
-
(
use_lld
|
|
(
use_gold
&
&
(
is_chromeos_ash
|
|
!
(
current_cpu
=
=
"
x86
"
|
|
-
current_cpu
=
=
"
x64
"
)
)
)
)
+
(
use_lld
|
|
(
use_gold
&
&
(
is_chromeos_ash
|
|
!
(
target_cpu
=
=
"
x86
"
|
|
+
target_cpu
=
=
"
x64
"
)
)
)
)
}
if
(
is_android
|
|
(
is_chromeos_ash
&
&
is_chromeos_device
)
)
{
-
341
7
+
341
7
config
(
"
compiler
"
)
{
}
#
The
x86
toolchain
currently
has
problems
with
stack
-
protector
.
-
if
(
is_android
&
&
current_cpu
=
=
"
x86
"
)
{
+
if
(
is_android
&
&
target_cpu
=
=
"
x86
"
)
{
cflags
+
=
[
"
-
fno
-
stack
-
protector
"
]
}
else
if
(
current_os
!
=
"
aix
"
)
{
#
Not
available
on
aix
.
-
455
7
+
455
7
config
(
"
compiler
"
)
{
#
Linux
-
specific
compiler
flags
setup
.
#
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
if
(
(
is_posix
|
|
is_fuchsia
)
&
&
!
is_apple
&
&
use_lld
)
{
-
if
(
current_cpu
=
=
"
arm64
"
)
{
+
if
(
target_cpu
=
=
"
arm64
"
)
{
#
Reduce
the
page
size
from
65536
in
order
to
reduce
binary
size
slightly
#
by
shrinking
the
alignment
gap
between
segments
.
This
also
causes
all
#
segments
to
be
mapped
adjacently
which
breakpad
relies
on
.
-
720
7
+
720
7
config
(
"
compiler
"
)
{
}
#
TODO
(
https
:
/
/
crbug
.
com
/
1211155
)
:
investigate
why
this
isn
'
t
effective
on
arm32
.
-
if
(
!
is_android
|
|
current_cpu
=
=
"
arm64
"
)
{
+
if
(
!
is_android
|
|
target_cpu
=
=
"
arm64
"
)
{
cflags
+
=
[
"
-
fwhole
-
program
-
vtables
"
]
if
(
!
is_win
)
{
ldflags
+
=
[
"
-
fwhole
-
program
-
vtables
"
]
-
732
7
+
732
7
config
(
"
compiler
"
)
{
#
unless
the
architecture
revision
in
.
ARM
.
attributes
is
sufficiently
new
.
#
TODO
(
pcc
)
:
The
contents
of
.
ARM
.
attributes
should
be
based
on
the
#
-
march
flag
passed
at
compile
time
(
see
llvm
.
org
/
pr36291
)
.
-
if
(
current_cpu
=
=
"
arm
"
)
{
+
if
(
target_cpu
=
=
"
arm
"
)
{
ldflags
+
=
[
"
-
march
=
arm_arch
"
]
}
}
-
891
14
+
891
14
config
(
"
compiler_cpu_abi
"
)
{
if
(
(
is_posix
&
&
!
is_apple
)
|
|
is_fuchsia
)
{
#
CPU
architecture
.
We
may
or
may
not
be
doing
a
cross
compile
now
so
for
#
simplicity
we
always
explicitly
set
the
architecture
.
-
if
(
current_cpu
=
=
"
x64
"
)
{
+
if
(
target_cpu
=
=
"
x64
"
)
{
cflags
+
=
[
"
-
m64
"
"
-
march
=
x64_arch
"
"
-
msse3
"
]
ldflags
+
=
[
"
-
m64
"
]
-
}
else
if
(
current_cpu
=
=
"
x86
"
)
{
+
}
else
if
(
target_cpu
=
=
"
x86
"
)
{
cflags
+
=
[
"
-
m32
"
]
ldflags
+
=
[
"
-
m32
"
]
if
(
!
is_nacl
)
{
-
907
7
+
907
7
config
(
"
compiler_cpu_abi
"
)
{
"
-
msse2
"
]
}
-
}
else
if
(
current_cpu
=
=
"
arm
"
)
{
+
}
else
if
(
target_cpu
=
=
"
arm
"
)
{
if
(
is_clang
&
&
!
is_android
&
&
!
is_nacl
)
{
cflags
+
=
[
"
-
-
target
=
arm
-
linux
-
gnueabihf
"
]
ldflags
+
=
[
"
-
-
target
=
arm
-
linux
-
gnueabihf
"
]
-
921
7
+
921
7
config
(
"
compiler_cpu_abi
"
)
{
if
(
arm_tune
!
=
"
"
)
{
cflags
+
=
[
"
-
mtune
=
arm_tune
"
]
}
-
}
else
if
(
current_cpu
=
=
"
arm64
"
)
{
+
}
else
if
(
target_cpu
=
=
"
arm64
"
)
{
if
(
is_clang
&
&
!
is_android
&
&
!
is_nacl
&
&
!
is_fuchsia
)
{
cflags
+
=
[
"
-
-
target
=
aarch64
-
linux
-
gnu
"
]
ldflags
+
=
[
"
-
-
target
=
aarch64
-
linux
-
gnu
"
]
-
930
7
+
930
7
config
(
"
compiler_cpu_abi
"
)
{
#
Outline
atomics
crash
on
Exynos
9810
.
http
:
/
/
crbug
.
com
/
1272795
cflags
+
=
[
"
-
mno
-
outline
-
atomics
"
]
}
-
}
else
if
(
current_cpu
=
=
"
mipsel
"
&
&
!
is_nacl
)
{
+
}
else
if
(
target_cpu
=
=
"
mipsel
"
&
&
!
is_nacl
)
{
ldflags
+
=
[
"
-
Wl
-
-
hash
-
style
=
sysv
"
]
if
(
custom_toolchain
=
=
"
"
)
{
if
(
is_clang
)
{
-
1015
7
+
1015
7
config
(
"
compiler_cpu_abi
"
)
{
}
cflags
+
=
[
"
-
m
{
mips_float_abi
}
-
float
"
]
-
}
else
if
(
current_cpu
=
=
"
mips
"
&
&
!
is_nacl
)
{
+
}
else
if
(
target_cpu
=
=
"
mips
"
&
&
!
is_nacl
)
{
ldflags
+
=
[
"
-
Wl
-
-
hash
-
style
=
sysv
"
]
if
(
custom_toolchain
=
=
"
"
)
{
if
(
is_clang
)
{
-
1060
7
+
1060
7
config
(
"
compiler_cpu_abi
"
)
{
}
cflags
+
=
[
"
-
m
{
mips_float_abi
}
-
float
"
]
-
}
else
if
(
current_cpu
=
=
"
mips64el
"
)
{
+
}
else
if
(
target_cpu
=
=
"
mips64el
"
)
{
cflags
+
=
[
"
-
D__SANE_USERSPACE_TYPES__
"
]
ldflags
+
=
[
"
-
Wl
-
-
hash
-
style
=
sysv
"
]
if
(
custom_toolchain
=
=
"
"
)
{
-
1124
7
+
1124
7
config
(
"
compiler_cpu_abi
"
)
{
"
-
Wa
-
march
=
loongson3a
"
]
}
-
}
else
if
(
current_cpu
=
=
"
mips64
"
)
{
+
}
else
if
(
target_cpu
=
=
"
mips64
"
)
{
ldflags
+
=
[
"
-
Wl
-
-
hash
-
style
=
sysv
"
]
if
(
custom_toolchain
=
=
"
"
)
{
if
(
is_clang
)
{
-
1162
7
+
1162
7
config
(
"
compiler_cpu_abi
"
)
{
]
ldflags
+
=
[
"
-
mips64r2
"
]
}
-
}
else
if
(
current_cpu
=
=
"
ppc64
"
)
{
+
}
else
if
(
target_cpu
=
=
"
ppc64
"
)
{
if
(
current_os
=
=
"
aix
"
)
{
cflags
+
=
[
"
-
maix64
"
]
ldflags
+
=
[
"
-
maix64
"
]
-
1170
7
+
1170
7
config
(
"
compiler_cpu_abi
"
)
{
cflags
+
=
[
"
-
m64
"
]
ldflags
+
=
[
"
-
m64
"
]
}
-
}
else
if
(
current_cpu
=
=
"
s390x
"
)
{
+
}
else
if
(
target_cpu
=
=
"
s390x
"
)
{
cflags
+
=
[
"
-
m64
"
]
ldflags
+
=
[
"
-
m64
"
]
}
-
1191
7
+
1191
7
config
(
"
compiler_codegen
"
)
{
configs
+
=
[
"
/
/
chromium
/
build
/
config
/
nacl
:
compiler_codegen
"
]
}
-
if
(
current_cpu
=
=
"
arm64
"
&
&
is_android
)
{
+
if
(
target_cpu
=
=
"
arm64
"
&
&
is_android
)
{
#
On
arm64
disable
outlining
for
Android
.
See
crbug
.
com
/
931297
for
more
#
information
.
cflags
+
=
[
"
-
mno
-
outline
"
]
-
1330
7
+
1330
7
config
(
"
rustc_revision
"
)
{
}
config
(
"
compiler_arm_fpu
"
)
{
-
if
(
current_cpu
=
=
"
arm
"
&
&
!
is_ios
&
&
!
is_nacl
)
{
+
if
(
target_cpu
=
=
"
arm
"
&
&
!
is_ios
&
&
!
is_nacl
)
{
cflags
=
[
"
-
mfpu
=
arm_fpu
"
]
if
(
!
arm_use_thumb
)
{
cflags
+
=
[
"
-
marm
"
]
-
1340
14
+
1340
14
config
(
"
compiler_arm_fpu
"
)
{
}
config
(
"
compiler_arm_thumb
"
)
{
-
if
(
current_cpu
=
=
"
arm
"
&
&
arm_use_thumb
&
&
is_posix
&
&
+
if
(
target_cpu
=
=
"
arm
"
&
&
arm_use_thumb
&
&
is_posix
&
&
!
(
is_apple
|
|
is_nacl
)
)
{
cflags
=
[
"
-
mthumb
"
]
}
}
config
(
"
compiler_arm
"
)
{
-
if
(
current_cpu
=
=
"
arm
"
&
&
(
is_chromeos_ash
|
|
is_chromeos_lacros
)
)
{
+
if
(
target_cpu
=
=
"
arm
"
&
&
(
is_chromeos_ash
|
|
is_chromeos_lacros
)
)
{
#
arm
is
normally
the
default
mode
for
clang
but
on
chromeos
a
wrapper
#
is
used
to
pass
-
mthumb
and
therefor
change
the
default
.
cflags
=
[
"
-
marm
"
]
-
1454
7
+
1454
7
config
(
"
default_warnings
"
)
{
#
Suppress
warnings
about
ABI
changes
on
ARM
(
Clang
doesn
'
t
give
this
#
warning
)
.
-
if
(
current_cpu
=
=
"
arm
"
&
&
!
is_clang
)
{
+
if
(
target_cpu
=
=
"
arm
"
&
&
!
is_clang
)
{
cflags
+
=
[
"
-
Wno
-
psabi
"
]
}
-
1626
9
+
1626
9
config
(
"
chromium_code
"
)
{
"
__STDC_FORMAT_MACROS
"
]
-
if
(
!
is_debug
&
&
!
using_sanitizer
&
&
current_cpu
!
=
"
s390x
"
&
&
-
current_cpu
!
=
"
s390
"
&
&
current_cpu
!
=
"
ppc64
"
&
&
-
current_cpu
!
=
"
mips
"
&
&
current_cpu
!
=
"
mips64
"
)
{
+
if
(
!
is_debug
&
&
!
using_sanitizer
&
&
target_cpu
!
=
"
s390x
"
&
&
+
target_cpu
!
=
"
s390
"
&
&
target_cpu
!
=
"
ppc64
"
&
&
+
target_cpu
!
=
"
mips
"
&
&
target_cpu
!
=
"
mips64
"
)
{
#
Non
-
chromium
code
is
not
guaranteed
to
compile
cleanly
with
#
_FORTIFY_SOURCE
.
Also
fortified
build
may
fail
when
optimizations
are
#
disabled
so
only
do
that
for
Release
build
.
-
1911
9
+
1911
9
config
(
"
no_incompatible_pointer_warnings
"
)
{
cflags
=
[
]
if
(
is_clang
)
{
cflags
+
=
[
"
-
Wno
-
incompatible
-
pointer
-
types
"
]
-
}
else
if
(
current_cpu
=
=
"
mipsel
"
|
|
current_cpu
=
=
"
mips64el
"
)
{
+
}
else
if
(
target_cpu
=
=
"
mipsel
"
|
|
target_cpu
=
=
"
mips64el
"
)
{
cflags
+
=
[
"
-
w
"
]
-
}
else
if
(
is_chromeos_ash
&
&
current_cpu
=
=
"
arm
"
)
{
+
}
else
if
(
is_chromeos_ash
&
&
target_cpu
=
=
"
arm
"
)
{
cflags
+
=
[
"
-
w
"
]
}
}
-
1967
7
+
1967
7
if
(
is_win
)
{
if
(
is_android
)
{
#
TODO
(
jdduke
)
Re
-
enable
on
mips
after
resolving
linking
#
issues
with
libc
+
+
(
crbug
.
com
/
456380
)
.
-
if
(
current_cpu
!
=
"
mipsel
"
&
&
current_cpu
!
=
"
mips64el
"
)
{
+
if
(
target_cpu
!
=
"
mipsel
"
&
&
target_cpu
!
=
"
mips64el
"
)
{
common_optimize_on_ldflags
+
=
[
#
Warn
in
case
of
text
relocations
.
"
-
Wl
-
-
warn
-
shared
-
textrel
"
-
2018
7
+
2018
7
config
(
"
default_stack_frames
"
)
{
#
Omit
frame
pointers
for
leaf
functions
on
x86
otherwise
building
libyuv
#
gives
clang
'
s
register
allocator
issues
see
llvm
.
org
/
PR15798
/
#
crbug
.
com
/
233709
-
if
(
is_clang
&
&
current_cpu
=
=
"
x86
"
&
&
!
is_apple
)
{
+
if
(
is_clang
&
&
target_cpu
=
=
"
x86
"
&
&
!
is_apple
)
{
cflags
+
=
[
"
-
momit
-
leaf
-
frame
-
pointer
"
]
}
}
else
{
-
2380
12
+
2380
12
config
(
"
symbols
"
)
{
#
DWARF
info
may
be
corrupt
;
offsets
in
a
range
list
entry
are
in
different
#
sections
"
there
.
Maybe
just
a
bug
in
nacl_switch_32
.
S
.
_enable_gdb_index
=
-
symbol_level
=
=
2
&
&
!
is_apple
&
&
!
is_nacl
&
&
current_cpu
!
=
"
x86
"
&
&
+
symbol_level
=
=
2
&
&
!
is_apple
&
&
!
is_nacl
&
&
target_cpu
!
=
"
x86
"
&
&
current_os
!
=
"
zos
"
&
&
(
use_gold
|
|
use_lld
)
&
&
#
Disable
on
non
-
fission
32
-
bit
Android
because
it
pushes
#
libcomponents_unittests
over
the
4gb
size
limit
.
-
!
(
is_android
&
&
!
use_debug_fission
&
&
current_cpu
!
=
"
x64
"
&
&
-
current_cpu
!
=
"
arm64
"
)
+
!
(
is_android
&
&
!
use_debug_fission
&
&
target_cpu
!
=
"
x64
"
&
&
+
target_cpu
!
=
"
arm64
"
)
if
(
_enable_gdb_index
)
{
if
(
is_clang
)
{
#
This
flag
enables
the
GNU
-
format
pubnames
and
pubtypes
sections
diff
-
-
git
a
/
config
/
compiler
/
compiler
.
gni
b
/
config
/
compiler
/
compiler
.
gni
index
c7a19e7c2
.
.
f1656a7c5
100644
-
-
-
a
/
config
/
compiler
/
compiler
.
gni
+
+
+
b
/
config
/
compiler
/
compiler
.
gni
-
16
7
+
16
7
import
(
"
/
/
build_overrides
/
build
.
gni
"
)
if
(
is_android
)
{
import
(
"
/
/
chromium
/
build
/
config
/
android
/
abi
.
gni
"
)
}
-
if
(
current_cpu
=
=
"
arm
"
|
|
current_cpu
=
=
"
arm64
"
)
{
+
if
(
target_cpu
=
=
"
arm
"
|
|
target_cpu
=
=
"
arm64
"
)
{
import
(
"
/
/
chromium
/
build
/
config
/
arm
.
gni
"
)
}
-
86
7
+
86
7
declare_args
(
)
{
#
#
It
'
s
currently
not
possible
to
collect
AFDO
profiles
on
anything
but
#
x86
{
_64
}
.
-
using_mismatched_sample_profile
=
current_cpu
!
=
"
x64
"
&
&
current_cpu
!
=
"
x86
"
+
using_mismatched_sample_profile
=
target_cpu
!
=
"
x64
"
&
&
target_cpu
!
=
"
x86
"
#
Whether
an
error
should
be
raised
on
attempts
to
make
debug
builds
with
#
is_component_build
=
false
.
Very
large
debug
symbols
can
have
unwanted
side
-
143
12
+
143
12
if
(
is_chromeos_ash
|
|
is_chromeos_lacros
)
{
#
However
Clang
does
not
currently
generate
usable
frame
pointers
in
ARM
#
32
-
bit
builds
(
https
:
/
/
bugs
.
llvm
.
org
/
show_bug
.
cgi
?
id
=
18505
)
so
disable
them
#
there
to
avoid
the
unnecessary
overhead
.
-
enable_frame_pointers
=
current_cpu
!
=
"
arm
"
+
enable_frame_pointers
=
target_cpu
!
=
"
arm
"
}
else
if
(
is_apple
|
|
is_linux
|
|
is_chromeos
)
{
enable_frame_pointers
=
true
}
else
if
(
is_win
)
{
#
64
-
bit
Windows
ABI
doesn
'
t
support
frame
pointers
.
-
if
(
current_cpu
=
=
"
x64
"
)
{
+
if
(
target_cpu
=
=
"
x64
"
)
{
enable_frame_pointers
=
false
}
else
{
enable_frame_pointers
=
true
-
157
19
+
157
19
if
(
is_chromeos_ash
|
|
is_chromeos_lacros
)
{
enable_frame_pointers
=
enable_profiling
|
|
#
Ensure
that
stacks
from
arm64
crash
dumps
are
usable
(
crbug
.
com
/
391706
)
.
-
current_cpu
=
=
"
arm64
"
|
|
+
target_cpu
=
=
"
arm64
"
|
|
#
For
x86
Android
unwind
tables
are
huge
without
frame
pointers
#
(
crbug
.
com
/
762629
)
.
Enabling
frame
pointers
grows
the
code
size
slightly
#
but
overall
shrinks
binaries
considerably
by
avoiding
huge
unwind
#
tables
.
-
(
current_cpu
=
=
"
x86
"
&
&
!
exclude_unwind_tables
&
&
optimize_for_size
)
|
|
+
(
target_cpu
=
=
"
x86
"
&
&
!
exclude_unwind_tables
&
&
optimize_for_size
)
|
|
using_sanitizer
|
|
#
For
caller
-
callee
instrumentation
version
which
needs
frame
pointers
to
#
get
the
caller
address
.
use_call_graph
}
else
if
(
is_fuchsia
)
{
#
Fuchsia
on
arm64
could
use
shadow
call
stack
for
unwinding
.
-
enable_frame_pointers
=
current_cpu
!
=
"
arm64
"
+
enable_frame_pointers
=
target_cpu
!
=
"
arm64
"
}
else
{
#
Explicitly
ask
for
frame
pointers
otherwise
stacks
may
be
missing
for
#
sanitizer
and
profiling
builds
.
-
181
7
+
181
7
if
(
is_chromeos_ash
|
|
is_chromeos_lacros
)
{
#
most
translation
units
that
they
are
emitted
correctly
and
that
the
#
compiler
or
platform
provides
a
way
to
access
them
.
can_unwind_with_frame_pointers
=
enable_frame_pointers
-
if
(
current_cpu
=
=
"
arm
"
&
&
arm_use_thumb
)
{
+
if
(
target_cpu
=
=
"
arm
"
&
&
arm_use_thumb
)
{
#
We
cannot
currently
unwind
ARM
Thumb
frame
pointers
correctly
.
#
See
https
:
/
/
bugs
.
llvm
.
org
/
show_bug
.
cgi
?
id
=
18505
can_unwind_with_frame_pointers
=
false
-
196
12
+
196
12
assert
(
!
can_unwind_with_frame_pointers
|
|
enable_frame_pointers
)
#
Unwinding
with
CFI
table
is
only
possible
on
static
library
builds
and
#
requried
only
when
frame
pointers
are
not
enabled
.
can_unwind_with_cfi_table
=
is_android
&
&
!
is_component_build
&
&
-
!
enable_frame_pointers
&
&
current_cpu
=
=
"
arm
"
+
!
enable_frame_pointers
&
&
target_cpu
=
=
"
arm
"
#
Whether
or
not
cfi
table
should
be
enabled
on
arm
.
#
TODO
(
crbug
.
com
/
1090409
)
:
Replace
can_unwind_with_cfi_table
with
this
once
#
sampling
profiler
is
enabled
on
android
.
-
enable_arm_cfi_table
=
is_android
&
&
!
is_component_build
&
&
current_cpu
=
=
"
arm
"
+
enable_arm_cfi_table
=
is_android
&
&
!
is_component_build
&
&
target_cpu
=
=
"
arm
"
declare_args
(
)
{
#
Set
to
true
to
use
the
android
unwinder
V2
implementation
.
-
226
13
+
226
13
declare_args
(
)
{
declare_args
(
)
{
#
Whether
to
use
the
gold
linker
from
binutils
instead
of
lld
or
bfd
.
use_gold
=
!
use_lld
&
&
!
(
is_chromecast
&
&
is_linux
&
&
-
(
current_cpu
=
=
"
arm
"
|
|
current_cpu
=
=
"
mipsel
"
)
)
&
&
+
(
target_cpu
=
=
"
arm
"
|
|
target_cpu
=
=
"
mipsel
"
)
)
&
&
(
(
(
is_linux
|
|
is_chromeos_lacros
)
&
&
-
(
current_cpu
=
=
"
x64
"
|
|
current_cpu
=
=
"
x86
"
|
|
-
current_cpu
=
=
"
arm
"
|
|
current_cpu
=
=
"
arm64
"
|
|
-
current_cpu
=
=
"
mipsel
"
|
|
current_cpu
=
=
"
mips64el
"
)
)
|
|
-
(
is_android
&
&
(
current_cpu
=
=
"
x86
"
|
|
current_cpu
=
=
"
x64
"
|
|
-
current_cpu
=
=
"
arm
"
|
|
current_cpu
=
=
"
arm64
"
)
)
)
+
(
target_cpu
=
=
"
x64
"
|
|
target_cpu
=
=
"
x86
"
|
|
+
target_cpu
=
=
"
arm
"
|
|
target_cpu
=
=
"
arm64
"
|
|
+
target_cpu
=
=
"
mipsel
"
|
|
target_cpu
=
=
"
mips64el
"
)
)
|
|
+
(
is_android
&
&
(
target_cpu
=
=
"
x86
"
|
|
target_cpu
=
=
"
x64
"
|
|
+
target_cpu
=
=
"
arm
"
|
|
target_cpu
=
=
"
arm64
"
)
)
)
}
#
Use
relative
paths
for
debug
info
.
This
is
important
to
make
the
build
diff
-
-
git
a
/
config
/
ios
/
BUILD
.
gn
b
/
config
/
ios
/
BUILD
.
gn
index
7323b25d3
.
.
284145458
100644
-
-
-
a
/
config
/
ios
/
BUILD
.
gn
+
+
+
b
/
config
/
ios
/
BUILD
.
gn
-
19
16
+
19
16
config
(
"
compiler
"
)
{
common_flags
=
[
]
#
CPU
architecture
.
-
if
(
current_cpu
=
=
"
x64
"
)
{
+
if
(
target_cpu
=
=
"
x64
"
)
{
triplet_cpu
=
"
x86_64
"
-
}
else
if
(
current_cpu
=
=
"
x86
"
)
{
+
}
else
if
(
target_cpu
=
=
"
x86
"
)
{
triplet_cpu
=
"
i386
"
-
}
else
if
(
current_cpu
=
=
"
arm
"
|
|
current_cpu
=
=
"
armv7
"
)
{
+
}
else
if
(
target_cpu
=
=
"
arm
"
|
|
target_cpu
=
=
"
armv7
"
)
{
triplet_cpu
=
"
armv7
"
-
}
else
if
(
current_cpu
=
=
"
arm64
"
)
{
+
}
else
if
(
target_cpu
=
=
"
arm64
"
)
{
triplet_cpu
=
"
arm64
"
}
else
{
-
assert
(
false
"
unsupported
cpu
:
current_cpu
"
)
+
assert
(
false
"
unsupported
cpu
:
target_cpu
"
)
}
#
Environment
.
-
126
7
+
126
7
config
(
"
runtime_library
"
)
{
#
TODO
(
crbug
.
com
/
1223481
)
:
Temporarily
use
a
different
#
libclang_rt
.
iossim
.
a
for
arm64
simulator
builds
.
This
can
be
#
removed
when
an
arm64
slice
is
added
to
upstream
Clang
.
-
if
(
target_environment
=
=
"
simulator
"
&
&
current_cpu
=
=
"
arm64
"
)
{
+
if
(
target_environment
=
=
"
simulator
"
&
&
target_cpu
=
=
"
arm64
"
)
{
assert
(
1300
<
=
xcode_version_int
&
&
xcode_version_int
<
=
1321
)
ldflags
+
=
[
"
-
lSystem
"
diff
-
-
git
a
/
config
/
ios
/
config
.
gni
b
/
config
/
ios
/
config
.
gni
index
754867769
.
.
358c7ccd2
100644
-
-
-
a
/
config
/
ios
/
config
.
gni
+
+
+
b
/
config
/
ios
/
config
.
gni
-
17
7
+
17
7
declare_args
(
)
{
}
if
(
target_environment
=
=
"
"
)
{
-
if
(
current_cpu
=
=
"
x86
"
|
|
current_cpu
=
=
"
x64
"
)
{
+
if
(
target_cpu
=
=
"
x86
"
|
|
target_cpu
=
=
"
x64
"
)
{
target_environment
=
"
simulator
"
}
else
{
target_environment
=
"
device
"
diff
-
-
git
a
/
config
/
ios
/
rules
.
gni
b
/
config
/
ios
/
rules
.
gni
index
cbccb4da8
.
.
dde736a43
100644
-
-
-
a
/
config
/
ios
/
rules
.
gni
+
+
+
b
/
config
/
ios
/
rules
.
gni
-
59
7
+
59
7
template
(
"
lipo_binary
"
)
{
_output_name
=
invoker
.
output_name
}
-
_all_target_cpu
=
[
current_cpu
]
+
additional_target_cpus
+
_all_target_cpu
=
[
target_cpu
]
+
additional_target_cpus
_all_toolchains
=
[
current_toolchain
]
+
additional_toolchains
_arch_binary_target
=
invoker
.
arch_binary_target
-
790
7
+
790
7
template
(
"
ios_app_bundle
"
)
{
output_name
=
_output_name
output_prefix_override
=
true
-
output_dir
=
"
target_out_dir
/
current_cpu
"
+
output_dir
=
"
target_out_dir
/
target_cpu
"
}
if
(
is_fat_secondary_toolchain
)
{
-
1403
7
+
1403
7
template
(
"
ios_framework_bundle
"
)
{
output_extension
=
"
"
output_name
=
_output_name
output_prefix_override
=
true
-
output_dir
=
"
target_out_dir
/
current_cpu
"
+
output_dir
=
"
target_out_dir
/
target_cpu
"
}
if
(
is_fat_secondary_toolchain
)
{
-
1748
7
+
1748
7
template
(
"
ios_xctest_bundle
"
)
{
deps
=
[
"
:
_arch_loadable_module_source
"
]
configs
+
=
[
"
/
/
chromium
/
build
/
config
/
ios
:
xctest_config
"
]
-
output_dir
=
"
target_out_dir
/
current_cpu
"
+
output_dir
=
"
target_out_dir
/
target_cpu
"
output_name
=
_output_name
output_prefix_override
=
true
output_extension
=
"
"
diff
-
-
git
a
/
config
/
linux
/
BUILD
.
gn
b
/
config
/
linux
/
BUILD
.
gn
index
9a60f997d
.
.
da6a9577b
100644
-
-
-
a
/
config
/
linux
/
BUILD
.
gn
+
+
+
b
/
config
/
linux
/
BUILD
.
gn
-
15
7
+
15
7
group
(
"
linux
"
)
{
#
is
applied
to
all
targets
.
It
is
here
to
separate
out
the
logic
that
is
#
Linux
-
only
.
This
is
not
applied
to
Android
but
is
applied
to
ChromeOS
.
config
(
"
compiler
"
)
{
-
if
(
current_cpu
=
=
"
arm64
"
)
{
+
if
(
target_cpu
=
=
"
arm64
"
)
{
import
(
"
/
/
chromium
/
build
/
config
/
arm
.
gni
"
)
cflags
=
[
]
asmflags
=
[
]
-
44
7
+
44
7
config
(
"
runtime_library
"
)
{
if
(
false
)
{
if
(
(
!
(
is_chromeos_ash
|
|
is_chromeos_lacros
)
|
|
default_toolchain
!
=
"
/
/
chromium
/
build
/
toolchain
/
cros
:
target
"
)
&
&
-
(
!
use_custom_libcxx
|
|
current_cpu
=
=
"
mipsel
"
)
)
{
+
(
!
use_custom_libcxx
|
|
target_cpu
=
=
"
mipsel
"
)
)
{
libs
=
[
"
atomic
"
]
}
}
diff
-
-
git
a
/
config
/
linux
/
pkg_config
.
gni
b
/
config
/
linux
/
pkg_config
.
gni
index
d42034446
.
.
f874aaaec
100644
-
-
-
a
/
config
/
linux
/
pkg_config
.
gni
+
+
+
b
/
config
/
linux
/
pkg_config
.
gni
-
60
7
+
60
7
if
(
sysroot
!
=
"
"
)
{
"
-
s
"
rebase_path
(
sysroot
)
"
-
a
"
-
current_cpu
+
target_cpu
]
}
diff
-
-
git
a
/
config
/
mac
/
BUILD
.
gn
b
/
config
/
mac
/
BUILD
.
gn
index
941125c1d
.
.
9b9c6f0c5
100644
-
-
-
a
/
config
/
mac
/
BUILD
.
gn
+
+
+
b
/
config
/
mac
/
BUILD
.
gn
-
16
14
+
16
14
config
(
"
compiler
"
)
{
common_mac_flags
=
[
]
#
CPU
architecture
.
-
if
(
current_cpu
=
=
"
x64
"
)
{
+
if
(
target_cpu
=
=
"
x64
"
)
{
clang_arch
=
"
x86_64
"
-
}
else
if
(
current_cpu
=
=
"
x86
"
)
{
+
}
else
if
(
target_cpu
=
=
"
x86
"
)
{
clang_arch
=
"
i386
"
-
}
else
if
(
current_cpu
=
=
"
arm64
"
)
{
-
clang_arch
=
current_cpu
+
}
else
if
(
target_cpu
=
=
"
arm64
"
)
{
+
clang_arch
=
target_cpu
}
else
{
-
assert
(
false
"
unknown
current_cpu
current_cpu
"
)
+
assert
(
false
"
unknown
target_cpu
target_cpu
"
)
}
if
(
host_os
=
=
"
mac
"
)
{
common_mac_flags
+
=
[
diff
-
-
git
a
/
config
/
mips
.
gni
b
/
config
/
mips
.
gni
index
f1a13310e
.
.
8c14384b2
100644
-
-
-
a
/
config
/
mips
.
gni
+
+
+
b
/
config
/
mips
.
gni
-
4
7
+
4
7
import
(
"
/
/
chromium
/
build
/
config
/
v8_target_cpu
.
gni
"
)
-
#
These
are
primarily
relevant
in
current_cpu
=
=
"
mips
*
"
contexts
where
+
#
These
are
primarily
relevant
in
target_cpu
=
=
"
mips
*
"
contexts
where
#
MIPS
code
is
being
compiled
.
But
they
can
also
be
relevant
in
the
#
other
contexts
when
the
code
will
change
its
behavior
based
on
the
#
cpu
it
wants
to
generate
code
for
.
-
13
8
+
13
8
declare_args
(
)
{
mips_use_mmi
=
false
}
-
if
(
current_cpu
=
=
"
mipsel
"
|
|
v8_current_cpu
=
=
"
mipsel
"
|
|
-
current_cpu
=
=
"
mips
"
|
|
v8_current_cpu
=
=
"
mips
"
)
{
+
if
(
target_cpu
=
=
"
mipsel
"
|
|
v8_target_cpu
=
=
"
mipsel
"
|
|
+
target_cpu
=
=
"
mips
"
|
|
v8_target_cpu
=
=
"
mips
"
)
{
declare_args
(
)
{
#
MIPS
arch
variant
.
Possible
values
are
:
#
"
r1
"
-
43
8
+
43
8
if
(
current_cpu
=
=
"
mipsel
"
|
|
v8_current_cpu
=
=
"
mipsel
"
|
|
#
"
fpxx
"
:
sets
the
GCC
-
mfpxx
option
.
mips_fpu_mode
=
"
fp32
"
}
-
}
else
if
(
current_cpu
=
=
"
mips64el
"
|
|
v8_current_cpu
=
=
"
mips64el
"
|
|
-
current_cpu
=
=
"
mips64
"
|
|
v8_current_cpu
=
=
"
mips64
"
)
{
+
}
else
if
(
target_cpu
=
=
"
mips64el
"
|
|
v8_target_cpu
=
=
"
mips64el
"
|
|
+
target_cpu
=
=
"
mips64
"
|
|
v8_target_cpu
=
=
"
mips64
"
)
{
#
MIPS
arch
variant
.
Possible
values
are
:
#
"
r2
"
#
"
r6
"
diff
-
-
git
a
/
config
/
nacl
/
BUILD
.
gn
b
/
config
/
nacl
/
BUILD
.
gn
index
d639729f7
.
.
917b82281
100644
-
-
-
a
/
config
/
nacl
/
BUILD
.
gn
+
+
+
b
/
config
/
nacl
/
BUILD
.
gn
-
17
7
+
17
7
config
(
"
nacl_defines
"
)
{
defines
=
[
"
__STDC_LIMIT_MACROS
=
1
"
]
}
-
if
(
current_cpu
=
=
"
pnacl
"
)
{
+
if
(
target_cpu
=
=
"
pnacl
"
)
{
#
TODO
:
Remove
the
following
definition
once
NACL_BUILD_ARCH
and
#
NACL_BUILD_SUBARCH
are
defined
by
the
PNaCl
toolchain
.
defines
+
=
[
"
NACL_BUILD_ARCH
=
pnacl
"
]
-
64
7
+
64
7
config
(
"
compiler
"
)
{
ldflags
=
[
]
libs
=
[
]
-
if
(
is_clang
&
&
current_cpu
!
=
"
pnacl
"
)
{
+
if
(
is_clang
&
&
target_cpu
!
=
"
pnacl
"
)
{
#
-
no
-
integrated
-
as
is
the
default
in
nacl
-
clang
for
historical
#
compatibility
with
inline
assembly
code
and
so
forth
.
But
there
#
are
no
such
cases
in
Chromium
code
and
-
integrated
-
as
is
nicer
in
-
90
7
+
90
7
config
(
"
compiler_codegen
"
)
{
"
-
fomit
-
frame
-
pointer
"
]
-
if
(
current_cpu
=
=
"
x86
"
)
{
+
if
(
target_cpu
=
=
"
x86
"
)
{
#
The
x86
-
32
IRT
needs
to
be
callable
with
an
under
-
aligned
#
stack
;
so
we
disable
SSE
instructions
which
can
fault
on
#
misaligned
addresses
.
See
diff
-
-
git
a
/
config
/
nacl
/
config
.
gni
b
/
config
/
nacl
/
config
.
gni
index
93a2ee709
.
.
37e600b44
100644
-
-
-
a
/
config
/
nacl
/
config
.
gni
+
+
+
b
/
config
/
nacl
/
config
.
gni
-
20
22
+
20
22
is_nacl_irt
=
false
nacl_toolchain_dir
=
"
/
/
native_client
/
toolchain
/
{
host_os
}
_x86
"
if
(
is_nacl_glibc
)
{
-
if
(
current_cpu
=
=
"
x86
"
|
|
current_cpu
=
=
"
x64
"
)
{
+
if
(
target_cpu
=
=
"
x86
"
|
|
target_cpu
=
=
"
x64
"
)
{
nacl_toolchain_package
=
"
nacl_x86_glibc
"
-
}
else
if
(
current_cpu
=
=
"
arm
"
)
{
+
}
else
if
(
target_cpu
=
=
"
arm
"
)
{
nacl_toolchain_package
=
"
nacl_arm_glibc
"
}
}
else
{
nacl_toolchain_package
=
"
pnacl_newlib
"
}
-
if
(
current_cpu
=
=
"
pnacl
"
)
{
+
if
(
target_cpu
=
=
"
pnacl
"
)
{
_nacl_tuple
=
"
pnacl
"
-
}
else
if
(
current_cpu
=
=
"
x86
"
|
|
current_cpu
=
=
"
x64
"
)
{
+
}
else
if
(
target_cpu
=
=
"
x86
"
|
|
target_cpu
=
=
"
x64
"
)
{
_nacl_tuple
=
"
x86_64
-
nacl
"
-
}
else
if
(
current_cpu
=
=
"
arm
"
)
{
+
}
else
if
(
target_cpu
=
=
"
arm
"
)
{
_nacl_tuple
=
"
arm
-
nacl
"
-
}
else
if
(
current_cpu
=
=
"
mipsel
"
)
{
+
}
else
if
(
target_cpu
=
=
"
mipsel
"
)
{
_nacl_tuple
=
"
mipsel
-
nacl
"
}
else
{
#
In
order
to
allow
this
file
to
be
included
unconditionally
diff
-
-
git
a
/
config
/
nacl
/
rules
.
gni
b
/
config
/
nacl
/
rules
.
gni
index
7d916e8f5
.
.
5a0daf061
100644
-
-
-
a
/
config
/
nacl
/
rules
.
gni
+
+
+
b
/
config
/
nacl
/
rules
.
gni
-
40
7
+
40
7
template
(
"
generate_nmf
"
)
{
#
TODO
(
phosek
)
:
Remove
this
conditional
once
#
https
:
/
/
bugs
.
chromium
.
org
/
p
/
nativeclient
/
issues
/
detail
?
id
=
4339
is
#
resolved
.
-
if
(
current_cpu
=
=
"
pnacl
"
)
{
+
if
(
target_cpu
=
=
"
pnacl
"
)
{
objdump
=
rebase_path
(
"
{
nacl_toolchain_bindir
}
/
x86_64
-
nacl
-
objdump
"
)
}
else
{
objdump
=
rebase_path
(
"
{
nacl_toolprefix
}
objdump
"
)
-
75
18
+
75
18
template
(
"
generate_nmf
"
)
{
#
NOTE
:
There
is
no
explicit
dependency
for
the
lib
directory
#
(
lib32
and
lib64
for
x86
/
x64
)
created
in
the
product
directory
.
#
They
are
created
as
a
side
-
effect
of
nmf
creation
.
-
if
(
current_cpu
!
=
"
x86
"
&
&
current_cpu
!
=
"
x64
"
)
{
+
if
(
target_cpu
!
=
"
x86
"
&
&
target_cpu
!
=
"
x64
"
)
{
nmfflags
+
=
[
"
-
-
library
-
path
=
"
+
rebase_path
(
"
{
nacl_toolchain_tooldir
}
/
lib
"
root_build_dir
)
]
-
if
(
current_cpu
=
=
"
arm
"
)
{
+
if
(
target_cpu
=
=
"
arm
"
)
{
data
+
=
[
"
{
lib_path
}
/
libarm
/
"
]
}
else
{
data
+
=
[
"
{
lib_path
}
/
lib
/
"
]
}
}
else
{
#
For
x86
-
32
the
lib
/
directory
is
called
lib32
/
instead
.
-
if
(
current_cpu
=
=
"
x86
"
)
{
+
if
(
target_cpu
=
=
"
x86
"
)
{
nmfflags
+
=
[
"
-
-
library
-
path
=
"
+
rebase_path
(
"
{
nacl_toolchain_tooldir
}
/
lib32
"
root_build_dir
)
]
-
98
12
+
98
12
template
(
"
generate_nmf
"
)
{
#
gets
handled
at
a
higher
level
(
see
the
nacl_test_data
template
)
#
so
a
single
generate_nmf
invocation
gets
both
x86
-
32
and
x86
-
64
#
nexes
listed
in
executables
.
-
if
(
current_cpu
=
=
"
x64
"
|
|
target_os
=
=
"
win
"
)
{
+
if
(
target_cpu
=
=
"
x64
"
|
|
target_os
=
=
"
win
"
)
{
#
For
x86
-
64
the
lib
/
directory
is
called
lib64
/
instead
#
when
copied
by
create_nmf
.
py
.
glibc_tc
=
"
/
/
chromium
/
build
/
toolchain
/
nacl
:
glibc
"
-
assert
(
current_toolchain
=
=
"
{
glibc_tc
}
_
{
current_cpu
}
"
)
-
if
(
current_cpu
=
=
"
x64
"
)
{
+
assert
(
current_toolchain
=
=
"
{
glibc_tc
}
_
{
target_cpu
}
"
)
+
if
(
target_cpu
=
=
"
x64
"
)
{
x64_out_dir
=
root_out_dir
}
else
{
x64_out_dir
=
get_label_info
(
"
:
{
target_name
}
(
{
glibc_tc
}
_x64
)
"
-
123
7
+
123
7
template
(
"
generate_nmf
"
)
{
"
-
-
objdump
=
"
+
rebase_path
(
objdump
root_build_dir
)
"
-
-
output
=
"
+
rebase_path
(
nmf
root_build_dir
)
]
+
nmfflags
+
rebase_path
(
sources
root_build_dir
)
-
if
(
is_nacl_glibc
&
&
current_cpu
=
=
"
arm
"
)
{
+
if
(
is_nacl_glibc
&
&
target_cpu
=
=
"
arm
"
)
{
deps
+
=
[
"
/
/
native_client
/
src
/
untrusted
/
elf_loader
:
elf_loader
"
]
}
}
diff
-
-
git
a
/
config
/
posix
/
BUILD
.
gn
b
/
config
/
posix
/
BUILD
.
gn
index
ce38e739f
.
.
6d0c6bd67
100644
-
-
-
a
/
config
/
posix
/
BUILD
.
gn
+
+
+
b
/
config
/
posix
/
BUILD
.
gn
-
35
7
+
35
7
config
(
"
runtime_library
"
)
{
#
changes
)
.
Nothing
should
ever
read
this
define
.
sysroot_hash
=
exec_script
(
"
/
/
chromium
/
build
/
linux
/
sysroot_scripts
/
install
-
sysroot
.
py
"
-
[
"
-
-
print
-
hash
=
current_cpu
"
]
+
[
"
-
-
print
-
hash
=
target_cpu
"
]
"
trim
string
"
[
"
/
/
chromium
/
build
/
linux
/
sysroot_scripts
/
sysroots
.
json
"
]
)
defines
+
=
[
"
CR_SYSROOT_HASH
=
sysroot_hash
"
]
diff
-
-
git
a
/
config
/
rust
.
gni
b
/
config
/
rust
.
gni
index
8aa69fcf1
.
.
ca3791960
100644
-
-
-
a
/
config
/
rust
.
gni
+
+
+
b
/
config
/
rust
.
gni
-
82
11
+
82
11
if
(
enable_rust
)
{
#
Platform
support
for
"
official
"
toolchains
(
Android
or
Chromium
)
android_toolchain_supports_platform
=
(
!
is_nacl
&
&
-
(
is_android
&
&
(
current_cpu
=
=
"
arm
"
|
|
current_cpu
=
=
"
arm64
"
|
|
-
current_cpu
=
=
"
x64
"
|
|
current_cpu
=
=
"
x86
"
)
)
)
|
|
-
(
is_linux
&
&
current_cpu
=
=
"
x64
"
)
+
(
is_android
&
&
(
target_cpu
=
=
"
arm
"
|
|
target_cpu
=
=
"
arm64
"
|
|
+
target_cpu
=
=
"
x64
"
|
|
target_cpu
=
=
"
x86
"
)
)
)
|
|
+
(
is_linux
&
&
target_cpu
=
=
"
x64
"
)
chromium_toolchain_supports_platform
=
-
!
is_nacl
&
&
is_linux
&
&
current_cpu
=
=
"
x64
"
+
!
is_nacl
&
&
is_linux
&
&
target_cpu
=
=
"
x64
"
toolchain_has_rust
=
enable_rust
&
&
-
149
25
+
149
25
if
(
is_android
)
{
rust_abi_target
=
"
armv7
-
linux
-
androideabi
"
}
}
else
if
(
is_fuchsia
)
{
-
if
(
current_cpu
=
=
"
arm64
"
)
{
+
if
(
target_cpu
=
=
"
arm64
"
)
{
rust_abi_target
=
"
aarch64
-
fuchsia
"
-
}
else
if
(
current_cpu
=
=
"
x64
"
)
{
+
}
else
if
(
target_cpu
=
=
"
x64
"
)
{
rust_abi_target
=
"
x86_64
-
fuchsia
"
}
else
{
assert
(
false
"
Architecture
not
supported
"
)
}
}
else
if
(
is_ios
)
{
-
if
(
current_cpu
=
=
"
arm64
"
)
{
+
if
(
target_cpu
=
=
"
arm64
"
)
{
rust_abi_target
=
"
aarch64
-
apple
-
ios
"
-
}
else
if
(
current_cpu
=
=
"
arm
"
)
{
+
}
else
if
(
target_cpu
=
=
"
arm
"
)
{
#
There
'
s
also
an
armv7s
-
apple
-
ios
which
targets
a
more
recent
ARMv7
#
generation
CPU
found
in
later
iPhones
.
We
'
ll
go
with
the
older
one
for
#
maximal
compatibility
.
As
we
come
to
support
all
the
different
platforms
#
with
Rust
we
might
want
to
be
more
precise
here
.
rust_abi_target
=
"
armv7
-
apple
-
ios
"
-
}
else
if
(
current_cpu
=
=
"
x64
"
)
{
+
}
else
if
(
target_cpu
=
=
"
x64
"
)
{
rust_abi_target
=
"
x86_64
-
apple
-
ios
"
-
}
else
if
(
current_cpu
=
=
"
x86
"
)
{
+
}
else
if
(
target_cpu
=
=
"
x86
"
)
{
rust_abi_target
=
"
i386
-
apple
-
ios
"
}
else
{
assert
(
false
"
Architecture
not
supported
"
)
diff
-
-
git
a
/
config
/
sanitizers
/
BUILD
.
gn
b
/
config
/
sanitizers
/
BUILD
.
gn
index
b74f8b583
.
.
59188cec0
100644
-
-
-
a
/
config
/
sanitizers
/
BUILD
.
gn
+
+
+
b
/
config
/
sanitizers
/
BUILD
.
gn
-
52
7
+
52
7
group
(
"
deps
"
)
{
}
}
-
assert
(
!
(
is_win
&
&
is_asan
&
&
current_cpu
=
=
"
x86
"
)
+
assert
(
!
(
is_win
&
&
is_asan
&
&
target_cpu
=
=
"
x86
"
)
"
ASan
is
only
supported
in
64
-
bit
builds
on
Windows
.
"
)
if
(
(
is_apple
|
|
is_win
)
&
&
is_asan
)
{
-
60
7
+
60
7
if
(
(
is_apple
|
|
is_win
)
&
&
is_asan
)
{
_clang_rt_dso_path
=
"
darwin
/
libclang_rt
.
asan_osx_dynamic
.
dylib
"
}
else
if
(
is_ios
)
{
_clang_rt_dso_path
=
"
darwin
/
libclang_rt
.
asan_iossim_dynamic
.
dylib
"
-
}
else
if
(
is_win
&
&
current_cpu
=
=
"
x64
"
)
{
+
}
else
if
(
is_win
&
&
target_cpu
=
=
"
x64
"
)
{
_clang_rt_dso_path
=
"
windows
/
clang_rt
.
asan_dynamic
-
x86_64
.
dll
"
}
-
218
14
+
218
14
config
(
"
default_sanitizer_ldflags
"
)
{
#
In
the
static
-
library
build
ASan
libraries
are
different
for
#
executables
and
dlls
see
link_executable
and
link_shared_library
below
.
#
This
here
handles
only
the
component
build
.
-
if
(
current_cpu
=
=
"
x64
"
)
{
+
if
(
target_cpu
=
=
"
x64
"
)
{
#
Windows
64
-
bit
.
libs
=
[
"
clang_rt
.
asan_dynamic
-
x86_64
.
lib
"
"
clang_rt
.
asan_dynamic_runtime_thunk
-
x86_64
.
lib
"
]
}
else
{
-
assert
(
current_cpu
=
=
"
x86
"
"
WinASan
unsupported
architecture
"
)
+
assert
(
target_cpu
=
=
"
x86
"
"
WinASan
unsupported
architecture
"
)
libs
=
[
"
clang_rt
.
asan_dynamic
-
i386
.
lib
"
"
clang_rt
.
asan_dynamic_runtime_thunk
-
i386
.
lib
"
-
233
7
+
233
7
config
(
"
default_sanitizer_ldflags
"
)
{
}
}
if
(
use_libfuzzer
)
{
-
assert
(
current_cpu
=
=
"
x64
"
"
LibFuzzer
unsupported
architecture
"
)
+
assert
(
target_cpu
=
=
"
x64
"
"
LibFuzzer
unsupported
architecture
"
)
assert
(
!
is_component_build
"
LibFuzzer
only
supports
non
-
component
builds
on
Windows
"
)
-
282
10
+
282
10
config
(
"
asan_flags
"
)
{
config
(
"
link_executable
"
)
{
if
(
is_asan
&
&
is_win
&
&
!
is_component_build
)
{
-
if
(
current_cpu
=
=
"
x64
"
)
{
+
if
(
target_cpu
=
=
"
x64
"
)
{
ldflags
=
[
"
-
wholearchive
:
clang_rt
.
asan
-
x86_64
.
lib
"
]
}
else
{
-
assert
(
current_cpu
=
=
"
x86
"
"
WinASan
unsupported
architecture
"
)
+
assert
(
target_cpu
=
=
"
x86
"
"
WinASan
unsupported
architecture
"
)
ldflags
=
[
"
-
wholearchive
:
clang_rt
.
asan
-
i386
.
lib
"
]
}
}
-
293
10
+
293
10
config
(
"
link_executable
"
)
{
config
(
"
link_shared_library
"
)
{
if
(
is_asan
&
&
is_win
&
&
!
is_component_build
)
{
-
if
(
current_cpu
=
=
"
x64
"
)
{
+
if
(
target_cpu
=
=
"
x64
"
)
{
libs
=
[
"
clang_rt
.
asan_dll_thunk
-
x86_64
.
lib
"
]
}
else
{
-
assert
(
current_cpu
=
=
"
x86
"
"
WinASan
unsupported
architecture
"
)
+
assert
(
target_cpu
=
=
"
x86
"
"
WinASan
unsupported
architecture
"
)
libs
=
[
"
clang_rt
.
asan_dll_thunk
-
i386
.
lib
"
]
}
}
-
380
7
+
380
7
config
(
"
coverage_flags
"
)
{
"
-
mllvm
"
"
-
sanitizer
-
coverage
-
prune
-
blocks
=
1
"
]
-
if
(
current_cpu
=
=
"
arm
"
)
{
+
if
(
target_cpu
=
=
"
arm
"
)
{
#
http
:
/
/
crbug
.
com
/
517105
cflags
+
=
[
"
-
mllvm
"
diff
-
-
git
a
/
config
/
sanitizers
/
sanitizers
.
gni
b
/
config
/
sanitizers
/
sanitizers
.
gni
index
2dc50feed
.
.
5ca8369ce
100644
-
-
-
a
/
config
/
sanitizers
/
sanitizers
.
gni
+
+
+
b
/
config
/
sanitizers
/
sanitizers
.
gni
-
142
7
+
142
7
if
(
!
is_a_target_toolchain
)
{
use_libfuzzer
=
false
use_locally_built_instrumented_libraries
=
false
use_sanitizer_coverage
=
false
-
}
else
if
(
current_cpu
!
=
"
arm64
"
)
{
+
}
else
if
(
target_cpu
!
=
"
arm64
"
)
{
is_hwasan
=
false
}
-
226
7
+
226
7
if
(
use_libfuzzer
&
&
(
is_linux
|
|
is_chromeos
)
)
{
assert
(
!
is_debug
|
|
!
(
is_msan
|
|
is_ubsan
|
|
is_ubsan_null
|
|
is_ubsan_vptr
)
"
Sanitizers
should
generally
be
used
in
release
(
set
is_debug
=
false
)
.
"
)
-
assert
(
!
is_msan
|
|
(
(
is_linux
|
|
is_chromeos
)
&
&
current_cpu
=
=
"
x64
"
)
+
assert
(
!
is_msan
|
|
(
(
is_linux
|
|
is_chromeos
)
&
&
target_cpu
=
=
"
x64
"
)
"
MSan
currently
only
works
on
64
-
bit
Linux
and
ChromeOS
builds
.
"
)
assert
(
!
is_lsan
|
|
is_asan
"
is_lsan
=
true
requires
is_asan
=
true
also
.
"
)
diff
-
-
git
a
/
config
/
sysroot
.
gni
b
/
config
/
sysroot
.
gni
index
14f708869
.
.
b1a1d4672
100644
-
-
-
a
/
config
/
sysroot
.
gni
+
+
+
b
/
config
/
sysroot
.
gni
-
21
13
+
21
13
declare_args
(
)
{
#
Controls
default
is_linux
sysroot
.
If
set
to
true
and
sysroot
#
is
empty
default
sysroot
is
calculated
.
-
use_sysroot
=
current_cpu
=
=
"
x86
"
|
|
current_cpu
=
=
"
x64
"
|
|
-
current_cpu
=
=
"
arm
"
|
|
current_cpu
=
=
"
arm64
"
|
|
-
current_cpu
=
=
"
mipsel
"
|
|
current_cpu
=
=
"
mips64el
"
+
use_sysroot
=
target_cpu
=
=
"
x86
"
|
|
target_cpu
=
=
"
x64
"
|
|
+
target_cpu
=
=
"
arm
"
|
|
target_cpu
=
=
"
arm64
"
|
|
+
target_cpu
=
=
"
mipsel
"
|
|
target_cpu
=
=
"
mips64el
"
}
if
(
sysroot
=
=
"
"
)
{
-
if
(
current_os
=
=
target_os
&
&
current_cpu
=
=
target_cpu
&
&
+
if
(
current_os
=
=
target_os
&
&
target_cpu
=
=
target_cpu
&
&
target_sysroot
!
=
"
"
)
{
sysroot
=
target_sysroot
}
else
if
(
is_android
)
{
-
38
24
+
38
24
if
(
sysroot
=
=
"
"
)
{
}
else
if
(
(
is_linux
|
|
is_chromeos
)
&
&
use_sysroot
)
{
#
By
default
build
against
a
sysroot
image
downloaded
from
Cloud
Storage
#
during
gclient
runhooks
.
-
if
(
current_cpu
=
=
"
x64
"
)
{
+
if
(
target_cpu
=
=
"
x64
"
)
{
sysroot
=
"
target_sysroot_dir
/
debian_sid_amd64
-
sysroot
"
-
}
else
if
(
current_cpu
=
=
"
x86
"
)
{
+
}
else
if
(
target_cpu
=
=
"
x86
"
)
{
sysroot
=
"
target_sysroot_dir
/
debian_sid_i386
-
sysroot
"
-
}
else
if
(
current_cpu
=
=
"
mipsel
"
)
{
+
}
else
if
(
target_cpu
=
=
"
mipsel
"
)
{
sysroot
=
"
target_sysroot_dir
/
debian_sid_mips
-
sysroot
"
-
}
else
if
(
current_cpu
=
=
"
mips64el
"
)
{
+
}
else
if
(
target_cpu
=
=
"
mips64el
"
)
{
sysroot
=
"
target_sysroot_dir
/
debian_sid_mips64el
-
sysroot
"
-
}
else
if
(
current_cpu
=
=
"
arm
"
)
{
+
}
else
if
(
target_cpu
=
=
"
arm
"
)
{
sysroot
=
"
target_sysroot_dir
/
debian_sid_arm
-
sysroot
"
-
}
else
if
(
current_cpu
=
=
"
arm64
"
)
{
+
}
else
if
(
target_cpu
=
=
"
arm64
"
)
{
sysroot
=
"
target_sysroot_dir
/
debian_sid_arm64
-
sysroot
"
}
else
{
assert
(
false
"
No
linux
sysroot
for
cpu
:
target_cpu
"
)
}
if
(
sysroot
!
=
"
"
)
{
-
_script_arch
=
current_cpu
+
_script_arch
=
target_cpu
if
(
_script_arch
=
=
"
x86
"
)
{
_script_arch
=
"
i386
"
}
else
if
(
_script_arch
=
=
"
x64
"
)
{
-
74
8
+
74
8
if
(
sysroot
=
=
"
"
)
{
import
(
"
/
/
chromium
/
build
/
config
/
ios
/
ios_sdk
.
gni
"
)
sysroot
=
ios_sdk_path
}
else
if
(
is_fuchsia
)
{
-
if
(
current_cpu
=
=
"
arm64
"
|
|
current_cpu
=
=
"
x64
"
)
{
-
sysroot
=
"
/
/
third_party
/
fuchsia
-
sdk
/
sdk
/
arch
/
current_cpu
/
sysroot
"
+
if
(
target_cpu
=
=
"
arm64
"
|
|
target_cpu
=
=
"
x64
"
)
{
+
sysroot
=
"
/
/
third_party
/
fuchsia
-
sdk
/
sdk
/
arch
/
target_cpu
/
sysroot
"
}
}
}
diff
-
-
git
a
/
config
/
win
/
BUILD
.
gn
b
/
config
/
win
/
BUILD
.
gn
index
29df64c97
.
.
818f34f40
100644
-
-
-
a
/
config
/
win
/
BUILD
.
gn
+
+
+
b
/
config
/
win
/
BUILD
.
gn
-
52
7
+
52
7
declare_args
(
)
{
#
is
applied
to
all
targets
.
It
is
here
to
separate
out
the
logic
that
is
#
Windows
-
only
.
config
(
"
compiler
"
)
{
-
if
(
current_cpu
=
=
"
x86
"
)
{
+
if
(
target_cpu
=
=
"
x86
"
)
{
asmflags
=
[
#
When
/
safeseh
is
specified
the
linker
will
only
produce
an
image
if
it
#
can
also
produce
a
table
of
the
image
'
s
safe
exception
handlers
.
This
-
101
20
+
101
20
config
(
"
compiler
"
)
{
]
}
-
if
(
current_cpu
=
=
"
x86
"
)
{
+
if
(
target_cpu
=
=
"
x86
"
)
{
cflags
+
=
[
"
-
m32
"
]
-
}
else
if
(
current_cpu
=
=
"
x64
"
)
{
+
}
else
if
(
target_cpu
=
=
"
x64
"
)
{
cflags
+
=
[
"
-
m64
"
]
-
}
else
if
(
current_cpu
=
=
"
arm64
"
)
{
+
}
else
if
(
target_cpu
=
=
"
arm64
"
)
{
cflags
+
=
[
"
-
-
target
=
arm64
-
windows
"
]
}
else
{
-
assert
(
false
"
unknown
current_cpu
"
+
current_cpu
)
+
assert
(
false
"
unknown
target_cpu
"
+
target_cpu
)
}
#
Chrome
currently
requires
SSE3
.
Clang
supports
targeting
any
Intel
#
microarchitecture
.
MSVC
only
supports
a
subset
of
architectures
and
the
#
next
step
after
SSE2
will
be
AVX
.
-
if
(
current_cpu
=
=
"
x86
"
|
|
current_cpu
=
=
"
x64
"
)
{
+
if
(
target_cpu
=
=
"
x86
"
|
|
target_cpu
=
=
"
x64
"
)
{
cflags
+
=
[
"
-
msse3
"
]
}
-
290
20
+
290
20
config
(
"
winver
"
)
{
#
Linker
flags
for
Windows
SDK
setup
this
is
applied
only
to
EXEs
and
DLLs
.
config
(
"
sdk_link
"
)
{
-
assert
(
current_cpu
=
=
"
x64
"
|
|
current_cpu
=
=
"
x86
"
|
|
current_cpu
=
=
"
arm
"
|
|
-
current_cpu
=
=
"
arm64
"
+
assert
(
target_cpu
=
=
"
x64
"
|
|
target_cpu
=
=
"
x86
"
|
|
target_cpu
=
=
"
arm
"
|
|
+
target_cpu
=
=
"
arm64
"
"
Only
supports
x64
x86
arm
and
arm64
CPUs
"
)
-
if
(
current_cpu
=
=
"
x64
"
)
{
+
if
(
target_cpu
=
=
"
x64
"
)
{
ldflags
=
[
"
/
MACHINE
:
X64
"
]
-
}
else
if
(
current_cpu
=
=
"
x86
"
)
{
+
}
else
if
(
target_cpu
=
=
"
x86
"
)
{
ldflags
=
[
"
/
MACHINE
:
X86
"
"
/
SAFESEH
"
#
Not
compatible
with
x64
so
use
only
for
x86
.
"
/
largeaddressaware
"
]
-
}
else
if
(
current_cpu
=
=
"
arm
"
)
{
+
}
else
if
(
target_cpu
=
=
"
arm
"
)
{
ldflags
=
[
"
/
MACHINE
:
ARM
"
]
-
}
else
if
(
current_cpu
=
=
"
arm64
"
)
{
+
}
else
if
(
target_cpu
=
=
"
arm64
"
)
{
ldflags
=
[
"
/
MACHINE
:
ARM64
"
]
}
-
313
7
+
313
7
config
(
"
sdk_link
"
)
{
windows_sdk_path
visual_studio_runtime_dirs
current_os
-
current_cpu
+
target_cpu
"
none
"
]
"
scope
"
)
-
549
11
+
549
11
config
(
"
static_crt
"
)
{
#
Subsystem
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
#
This
is
appended
to
the
subsystem
to
specify
a
minimum
version
.
-
if
(
current_cpu
=
=
"
x64
"
)
{
+
if
(
target_cpu
=
=
"
x64
"
)
{
#
The
number
after
the
comma
is
the
minimum
required
OS
version
.
#
5
.
02
=
Windows
Server
2003
.
subsystem_version_suffix
=
"
5
.
02
"
-
}
else
if
(
current_cpu
=
=
"
arm64
"
)
{
+
}
else
if
(
target_cpu
=
=
"
arm64
"
)
{
#
Windows
ARM64
requires
Windows
10
.
subsystem_version_suffix
=
"
10
.
0
"
}
else
{
diff
-
-
git
a
/
config
/
x64
.
gni
b
/
config
/
x64
.
gni
index
9e86979cb
.
.
eccf417c0
100644
-
-
-
a
/
config
/
x64
.
gni
+
+
+
b
/
config
/
x64
.
gni
-
2
9
+
2
9
#
Use
of
this
source
code
is
governed
by
a
BSD
-
style
license
that
can
be
#
found
in
the
LICENSE
file
.
-
#
These
are
primarily
relevant
in
current_cpu
=
=
"
x64
"
contexts
where
+
#
These
are
primarily
relevant
in
target_cpu
=
=
"
x64
"
contexts
where
#
X64
code
is
being
compiled
.
-
if
(
current_cpu
=
=
"
x64
"
)
{
+
if
(
target_cpu
=
=
"
x64
"
)
{
declare_args
(
)
{
#
The
micro
architecture
of
x64
cpu
.
This
will
be
a
string
like
"
haswell
"
or
#
"
skylake
"
.
An
empty
string
means
to
use
the
default
architecture
which
is
diff
-
-
git
a
/
linux
/
extract_symbols
.
gni
b
/
linux
/
extract_symbols
.
gni
index
3dc7fa005
.
.
a4bd6d182
100644
-
-
-
a
/
linux
/
extract_symbols
.
gni
+
+
+
b
/
linux
/
extract_symbols
.
gni
-
10
7
+
10
7
import
(
"
/
/
chromium
/
build
/
toolchain
/
toolchain
.
gni
"
)
#
binary
:
Path
to
the
binary
containing
symbols
to
extract
e
.
g
.
:
#
"
root_out_dir
/
chrome
"
#
symbol_file
:
Desired
output
file
for
symbols
e
.
g
.
:
-
#
"
root_out_dir
/
chrome
.
breakpad
.
current_cpu
"
+
#
"
root_out_dir
/
chrome
.
breakpad
.
target_cpu
"
template
(
"
extract_symbols
"
)
{
forward_variables_from
(
invoker
[
diff
-
-
git
a
/
toolchain
/
aix
/
BUILD
.
gn
b
/
toolchain
/
aix
/
BUILD
.
gn
index
71ce31573
.
.
5b8b37b35
100644
-
-
-
a
/
toolchain
/
aix
/
BUILD
.
gn
+
+
+
b
/
toolchain
/
aix
/
BUILD
.
gn
-
14
7
+
14
7
gcc_toolchain
(
"
ppc64
"
)
{
ld
=
cxx
toolchain_args
=
{
-
current_cpu
=
"
ppc64
"
+
target_cpu
=
"
ppc64
"
current_os
=
"
aix
"
#
reclient
does
not
support
gcc
.
diff
-
-
git
a
/
toolchain
/
android
/
BUILD
.
gn
b
/
toolchain
/
android
/
BUILD
.
gn
index
b018d2d4a
.
.
abd3f4141
100644
-
-
-
a
/
toolchain
/
android
/
BUILD
.
gn
+
+
+
b
/
toolchain
/
android
/
BUILD
.
gn
-
62
7
+
62
7
android_clang_toolchain
(
"
android_clang_x86
"
)
{
binary_prefix
=
"
i686
-
linux
-
android
"
}
toolchain_args
=
{
-
current_cpu
=
"
x86
"
+
target_cpu
=
"
x86
"
#
We
lack
the
libclang_rt
.
profile
library
for
x86
and
x86_64
so
we
cannot
#
link
any
binaries
that
are
generated
with
coverage
instrumentation
.
-
89
7
+
89
7
android_clang_toolchain
(
"
android_clang_arm
"
)
{
binary_prefix
=
"
arm
-
linux
-
androideabi
"
}
toolchain_args
=
{
-
current_cpu
=
"
arm
"
+
target_cpu
=
"
arm
"
}
}
-
98
7
+
98
7
android_clang_toolchain
(
"
android_clang_mipsel
"
)
{
binary_prefix
=
"
mipsel
-
linux
-
android
"
}
toolchain_args
=
{
-
current_cpu
=
"
mipsel
"
+
target_cpu
=
"
mipsel
"
}
}
-
107
7
+
107
7
android_clang_toolchain
(
"
android_clang_x64
"
)
{
binary_prefix
=
"
x86_64
-
linux
-
android
"
}
toolchain_args
=
{
-
current_cpu
=
"
x64
"
+
target_cpu
=
"
x64
"
#
We
lack
the
libclang_rt
.
profile
library
for
x86
and
x86_64
so
we
cannot
#
link
any
binaries
that
are
generated
with
coverage
instrumentation
.
-
134
7
+
134
7
android_clang_toolchain
(
"
android_clang_arm64
"
)
{
binary_prefix
=
"
aarch64
-
linux
-
android
"
}
toolchain_args
=
{
-
current_cpu
=
"
arm64
"
+
target_cpu
=
"
arm64
"
}
}
-
143
7
+
143
7
android_clang_toolchain
(
"
android_clang_arm64_hwasan
"
)
{
binary_prefix
=
"
aarch64
-
linux
-
android
"
}
toolchain_args
=
{
-
current_cpu
=
"
arm64
"
+
target_cpu
=
"
arm64
"
is_hwasan
=
true
android64_ndk_api_level
=
29
}
-
154
6
+
154
6
android_clang_toolchain
(
"
android_clang_mips64el
"
)
{
binary_prefix
=
"
mips64el
-
linux
-
android
"
}
toolchain_args
=
{
-
current_cpu
=
"
mips64el
"
+
target_cpu
=
"
mips64el
"
}
}
diff
-
-
git
a
/
toolchain
/
cros
/
BUILD
.
gn
b
/
toolchain
/
cros
/
BUILD
.
gn
index
8ba2068d9
.
.
d6784e819
100644
-
-
-
a
/
toolchain
/
cros
/
BUILD
.
gn
+
+
+
b
/
toolchain
/
cros
/
BUILD
.
gn
-
65
7
+
65
7
template
(
"
cros_toolchain
"
)
{
#
This
is
the
normal
toolchain
for
most
targets
.
cros_toolchain
(
"
target
"
)
{
toolchain_args
=
{
-
current_cpu
=
target_cpu
+
target_cpu
=
target_cpu
current_os
=
"
chromeos
"
sysroot
=
target_sysroot
}
-
97
7
+
97
7
cros_toolchain
(
"
target
"
)
{
#
use_sysroot
off
and
allows
the
user
to
set
different
sets
of
extra
flags
.
cros_toolchain
(
"
nacl_bootstrap
"
)
{
toolchain_args
=
{
-
current_cpu
=
target_cpu
+
target_cpu
=
target_cpu
current_os
=
"
chromeos
"
use_debug_fission
=
false
use_gold
=
false
-
127
7
+
127
7
cros_toolchain
(
"
nacl_bootstrap
"
)
{
cros_toolchain
(
"
host
"
)
{
toolchain_args
=
{
-
current_cpu
=
host_cpu
+
target_cpu
=
host_cpu
current_os
=
"
linux
"
sysroot
=
cros_host_sysroot
}
-
157
11
+
157
11
cros_toolchain
(
"
host
"
)
{
cros_toolchain
(
"
v8_snapshot
"
)
{
toolchain_args
=
{
if
(
target_cpu
=
=
"
x86
"
|
|
target_cpu
=
=
"
arm
"
|
|
target_cpu
=
=
"
mipsel
"
)
{
-
current_cpu
=
"
x86
"
+
target_cpu
=
"
x86
"
}
else
{
-
current_cpu
=
"
x64
"
+
target_cpu
=
"
x64
"
}
-
v8_current_cpu
=
v8_target_cpu
+
v8_target_cpu
=
v8_target_cpu
current_os
=
"
linux
"
sysroot
=
cros_v8_snapshot_sysroot
}
-
214
7
+
214
7
if
(
also_build_lacros_chrome_for_architecture
!
=
"
"
)
{
cros_v8_snapshot_sysroot
=
lacros_v8_snapshot_sysroot
current_os
=
"
chromeos
"
target_os
=
"
chromeos
"
-
current_cpu
=
current_cpu
+
target_cpu
=
target_cpu
also_build_lacros_chrome_for_architecture
=
"
"
chromeos_is_browser_only
=
true
use_clang_coverage
=
false
diff
-
-
git
a
/
toolchain
/
fuchsia
/
BUILD
.
gn
b
/
toolchain
/
fuchsia
/
BUILD
.
gn
index
643e12841
.
.
3010cb7a0
100644
-
-
-
a
/
toolchain
/
fuchsia
/
BUILD
.
gn
+
+
+
b
/
toolchain
/
fuchsia
/
BUILD
.
gn
-
26
12
+
26
12
template
(
"
fuchsia_clang_toolchain
"
)
{
fuchsia_clang_toolchain
(
"
x64
"
)
{
toolchain_args
=
{
-
current_cpu
=
"
x64
"
+
target_cpu
=
"
x64
"
}
}
fuchsia_clang_toolchain
(
"
arm64
"
)
{
toolchain_args
=
{
-
current_cpu
=
"
arm64
"
+
target_cpu
=
"
arm64
"
}
}
diff
-
-
git
a
/
toolchain
/
gcc_toolchain
.
gni
b
/
toolchain
/
gcc_toolchain
.
gni
index
1ef33e2e0
.
.
d8ce35f34
100644
-
-
-
a
/
toolchain
/
gcc_toolchain
.
gni
+
+
+
b
/
toolchain
/
gcc_toolchain
.
gni
-
128
8
+
128
8
template
(
"
gcc_toolchain
"
)
{
assert
(
defined
(
invoker
.
toolchain_args
)
"
Toolchains
must
specify
toolchain_args
"
)
invoker_toolchain_args
=
invoker
.
toolchain_args
-
assert
(
defined
(
invoker_toolchain_args
.
current_cpu
)
-
"
toolchain_args
must
specify
a
current_cpu
"
)
+
assert
(
defined
(
invoker_toolchain_args
.
target_cpu
)
+
"
toolchain_args
must
specify
a
target_cpu
"
)
assert
(
defined
(
invoker_toolchain_args
.
current_os
)
"
toolchain_args
must
specify
a
current_os
"
)
-
145
8
+
145
8
template
(
"
gcc_toolchain
"
)
{
#
set
on
those
toolchains
.
host_toolchain
=
host_toolchain
-
if
(
!
defined
(
invoker_toolchain_args
.
v8_current_cpu
)
)
{
-
v8_current_cpu
=
invoker_toolchain_args
.
current_cpu
+
if
(
!
defined
(
invoker_toolchain_args
.
v8_target_cpu
)
)
{
+
v8_target_cpu
=
invoker_toolchain_args
.
target_cpu
}
#
Whether
rustc
can
successfully
link
binaries
.
(
If
not
rust
code
diff
-
-
git
a
/
toolchain
/
ios
/
BUILD
.
gn
b
/
toolchain
/
ios
/
BUILD
.
gn
index
ef6fcfafa
.
.
25d6b3c29
100644
-
-
-
a
/
toolchain
/
ios
/
BUILD
.
gn
+
+
+
b
/
toolchain
/
ios
/
BUILD
.
gn
-
29
20
+
29
20
template
(
"
ios_toolchain
"
)
{
ios_toolchain
(
"
ios_clang_arm64
"
)
{
toolchain_args
=
{
-
current_cpu
=
"
arm64
"
+
target_cpu
=
"
arm64
"
}
}
ios_toolchain
(
"
ios_clang_arm64_13_0
"
)
{
toolchain_args
=
{
-
current_cpu
=
"
arm64
"
+
target_cpu
=
"
arm64
"
ios_deployment_target
=
"
13
.
0
"
}
}
ios_toolchain
(
"
ios_clang_arm64_fat_arm
"
)
{
toolchain_args
=
{
-
current_cpu
=
"
arm
"
+
target_cpu
=
"
arm
"
is_fat_secondary_toolchain
=
true
primary_fat_toolchain_name
=
"
/
/
chromium
/
build
/
toolchain
/
ios
:
ios_clang_arm64
"
}
-
50
19
+
50
19
ios_toolchain
(
"
ios_clang_arm64_fat_arm
"
)
{
ios_toolchain
(
"
ios_clang_arm
"
)
{
toolchain_args
=
{
-
current_cpu
=
"
arm
"
+
target_cpu
=
"
arm
"
}
}
ios_toolchain
(
"
ios_clang_x64
"
)
{
toolchain_args
=
{
-
current_cpu
=
"
x64
"
+
target_cpu
=
"
x64
"
}
}
ios_toolchain
(
"
ios_clang_x64_fat_arm64
"
)
{
toolchain_args
=
{
-
current_cpu
=
"
arm64
"
+
target_cpu
=
"
arm64
"
is_fat_secondary_toolchain
=
true
primary_fat_toolchain_name
=
"
/
/
chromium
/
build
/
toolchain
/
ios
:
ios_clang_x64
"
}
-
70
14
+
70
14
ios_toolchain
(
"
ios_clang_x64_fat_arm64
"
)
{
ios_toolchain
(
"
ios_clang_x64_13_0
"
)
{
toolchain_args
=
{
-
current_cpu
=
"
x64
"
+
target_cpu
=
"
x64
"
ios_deployment_target
=
"
13
.
0
"
}
}
ios_toolchain
(
"
ios_clang_x64_fat_x86
"
)
{
toolchain_args
=
{
-
current_cpu
=
"
x86
"
+
target_cpu
=
"
x86
"
is_fat_secondary_toolchain
=
true
primary_fat_toolchain_name
=
"
/
/
chromium
/
build
/
toolchain
/
ios
:
ios_clang_x64
"
}
-
85
6
+
85
6
ios_toolchain
(
"
ios_clang_x64_fat_x86
"
)
{
ios_toolchain
(
"
ios_clang_x86
"
)
{
toolchain_args
=
{
-
current_cpu
=
"
x86
"
+
target_cpu
=
"
x86
"
}
}
diff
-
-
git
a
/
toolchain
/
linux
/
BUILD
.
gn
b
/
toolchain
/
linux
/
BUILD
.
gn
index
6e6bf839f
.
.
63f4fae76
100644
-
-
-
a
/
toolchain
/
linux
/
BUILD
.
gn
+
+
+
b
/
toolchain
/
linux
/
BUILD
.
gn
-
10
21
+
10
21
import
(
"
/
/
chromium
/
build
/
toolchain
/
gcc_toolchain
.
gni
"
)
clang_toolchain
(
"
clang_ppc64
"
)
{
enable_linker_map
=
true
toolchain_args
=
{
-
current_cpu
=
"
ppc64
"
+
target_cpu
=
"
ppc64
"
current_os
=
"
linux
"
}
}
clang_toolchain
(
"
clang_arm
"
)
{
toolchain_args
=
{
-
current_cpu
=
"
arm
"
+
target_cpu
=
"
arm
"
current_os
=
"
linux
"
}
}
clang_toolchain
(
"
clang_arm64
"
)
{
toolchain_args
=
{
-
current_cpu
=
"
arm64
"
+
target_cpu
=
"
arm64
"
current_os
=
"
linux
"
}
}
-
41
7
+
41
7
gcc_toolchain
(
"
arm64
"
)
{
nm
=
"
{
toolprefix
}
nm
"
toolchain_args
=
{
-
current_cpu
=
"
arm64
"
+
target_cpu
=
"
arm64
"
current_os
=
"
linux
"
#
reclient
does
not
support
gcc
.
-
62
7
+
62
7
gcc_toolchain
(
"
arm
"
)
{
nm
=
"
{
toolprefix
}
nm
"
toolchain_args
=
{
-
current_cpu
=
"
arm
"
+
target_cpu
=
"
arm
"
current_os
=
"
linux
"
#
reclient
does
not
support
gcc
.
-
76
7
+
76
7
clang_toolchain
(
"
clang_x86
"
)
{
enable_linker_map
=
true
toolchain_args
=
{
-
current_cpu
=
"
x86
"
+
target_cpu
=
"
x86
"
current_os
=
"
linux
"
}
}
-
94
7
+
94
7
gcc_toolchain
(
"
x86
"
)
{
enable_linker_map
=
true
toolchain_args
=
{
-
current_cpu
=
"
x86
"
+
target_cpu
=
"
x86
"
current_os
=
"
linux
"
#
reclient
does
not
support
gcc
.
-
108
7
+
108
7
clang_toolchain
(
"
clang_x64
"
)
{
enable_linker_map
=
true
toolchain_args
=
{
-
current_cpu
=
"
x64
"
+
target_cpu
=
"
x64
"
current_os
=
"
linux
"
}
}
-
124
57
+
124
57
template
(
"
clang_v8_toolchain
"
)
{
clang_v8_toolchain
(
"
clang_x86_v8_arm
"
)
{
toolchain_args
=
{
-
current_cpu
=
"
x86
"
-
v8_current_cpu
=
"
arm
"
+
target_cpu
=
"
x86
"
+
v8_target_cpu
=
"
arm
"
}
}
clang_v8_toolchain
(
"
clang_x86_v8_mipsel
"
)
{
toolchain_args
=
{
-
current_cpu
=
"
x86
"
-
v8_current_cpu
=
"
mipsel
"
+
target_cpu
=
"
x86
"
+
v8_target_cpu
=
"
mipsel
"
}
}
clang_v8_toolchain
(
"
clang_x86_v8_mips
"
)
{
toolchain_args
=
{
-
current_cpu
=
"
x86
"
-
v8_current_cpu
=
"
mips
"
+
target_cpu
=
"
x86
"
+
v8_target_cpu
=
"
mips
"
}
}
clang_v8_toolchain
(
"
clang_x64_v8_arm64
"
)
{
toolchain_args
=
{
-
current_cpu
=
"
x64
"
-
v8_current_cpu
=
"
arm64
"
+
target_cpu
=
"
x64
"
+
v8_target_cpu
=
"
arm64
"
}
}
clang_v8_toolchain
(
"
clang_x64_v8_mips64el
"
)
{
toolchain_args
=
{
-
current_cpu
=
"
x64
"
-
v8_current_cpu
=
"
mips64el
"
+
target_cpu
=
"
x64
"
+
v8_target_cpu
=
"
mips64el
"
}
}
clang_v8_toolchain
(
"
clang_x64_v8_mips64
"
)
{
toolchain_args
=
{
-
current_cpu
=
"
x64
"
-
v8_current_cpu
=
"
mips64
"
+
target_cpu
=
"
x64
"
+
v8_target_cpu
=
"
mips64
"
}
}
clang_v8_toolchain
(
"
clang_x64_v8_riscv64
"
)
{
toolchain_args
=
{
-
current_cpu
=
"
x64
"
-
v8_current_cpu
=
"
riscv64
"
+
target_cpu
=
"
x64
"
+
v8_target_cpu
=
"
riscv64
"
}
}
clang_v8_toolchain
(
"
clang_x64_v8_loong64
"
)
{
toolchain_args
=
{
-
current_cpu
=
"
x64
"
-
v8_current_cpu
=
"
loong64
"
+
target_cpu
=
"
x64
"
+
v8_target_cpu
=
"
loong64
"
}
}
-
185
7
+
185
7
clang_toolchain
(
"
ash_clang_x64
"
)
{
#
This
turns
the
toolchain
into
the
"
Linux
ChromeOS
"
build
current_os
=
"
chromeos
"
target_os
=
"
chromeos
"
-
current_cpu
=
current_cpu
+
target_cpu
=
target_cpu
#
This
turns
off
all
of
the
LaCrOS
-
specific
flags
.
also_build_ash_chrome
=
false
-
201
7
+
201
7
clang_toolchain
(
"
lacros_clang_x64
"
)
{
#
This
turns
the
toolchain
into
the
"
Lacros
"
build
current_os
=
"
chromeos
"
target_os
=
"
chromeos
"
-
current_cpu
=
current_cpu
+
target_cpu
=
target_cpu
#
This
turns
on
the
LaCrOS
-
specific
flag
.
also_build_lacros_chrome
=
false
-
223
7
+
223
7
gcc_toolchain
(
"
x64
"
)
{
enable_linker_map
=
true
toolchain_args
=
{
-
current_cpu
=
"
x64
"
+
target_cpu
=
"
x64
"
current_os
=
"
linux
"
#
reclient
does
not
support
gcc
.
-
234
21
+
234
21
gcc_toolchain
(
"
x64
"
)
{
clang_toolchain
(
"
clang_mipsel
"
)
{
toolchain_args
=
{
-
current_cpu
=
"
mipsel
"
+
target_cpu
=
"
mipsel
"
current_os
=
"
linux
"
}
}
clang_toolchain
(
"
clang_mips64el
"
)
{
toolchain_args
=
{
-
current_cpu
=
"
mips64el
"
+
target_cpu
=
"
mips64el
"
current_os
=
"
linux
"
}
}
clang_toolchain
(
"
clang_mips64
"
)
{
toolchain_args
=
{
-
current_cpu
=
"
mips64
"
+
target_cpu
=
"
mips64
"
current_os
=
"
linux
"
}
}
-
265
7
+
265
7
gcc_toolchain
(
"
mipsel
"
)
{
toolchain_args
=
{
cc_wrapper
=
"
"
-
current_cpu
=
"
mipsel
"
+
target_cpu
=
"
mipsel
"
current_os
=
"
linux
"
#
reclient
does
not
support
gcc
.
-
287
7
+
287
7
gcc_toolchain
(
"
mips64el
"
)
{
toolchain_args
=
{
cc_wrapper
=
"
"
-
current_cpu
=
"
mips64el
"
+
target_cpu
=
"
mips64el
"
current_os
=
"
linux
"
#
reclient
does
not
support
gcc
.
-
316
7
+
316
7
gcc_toolchain
(
"
riscv64
"
)
{
ld
=
cxx
toolchain_args
=
{
-
current_cpu
=
"
riscv64
"
+
target_cpu
=
"
riscv64
"
current_os
=
"
linux
"
is_clang
=
false
}
-
324
7
+
324
7
gcc_toolchain
(
"
riscv64
"
)
{
clang_toolchain
(
"
clang_s390x
"
)
{
toolchain_args
=
{
-
current_cpu
=
"
s390x
"
+
target_cpu
=
"
s390x
"
current_os
=
"
linux
"
is_clang
=
true
}
-
340
7
+
340
7
gcc_toolchain
(
"
s390x
"
)
{
ld
=
cxx
toolchain_args
=
{
-
current_cpu
=
"
s390x
"
+
target_cpu
=
"
s390x
"
current_os
=
"
linux
"
#
reclient
does
not
support
gcc
.
-
359
7
+
359
7
gcc_toolchain
(
"
s390x
"
)
{
#
ld
=
cxx
#
#
toolchain_args
=
{
-
#
current_cpu
=
"
mips64
"
+
#
target_cpu
=
"
mips64
"
#
current_os
=
"
linux
"
#
is_clang
=
false
#
}
-
375
7
+
375
7
gcc_toolchain
(
"
ppc64
"
)
{
ld
=
cxx
toolchain_args
=
{
-
current_cpu
=
"
ppc64
"
+
target_cpu
=
"
ppc64
"
current_os
=
"
linux
"
#
reclient
does
not
support
gcc
.
-
396
7
+
396
7
gcc_toolchain
(
"
mips
"
)
{
ld
=
cxx
toolchain_args
=
{
-
current_cpu
=
"
mips
"
+
target_cpu
=
"
mips
"
current_os
=
"
linux
"
#
reclient
does
not
support
gcc
.
-
417
7
+
417
7
gcc_toolchain
(
"
mips64
"
)
{
ld
=
cxx
toolchain_args
=
{
-
current_cpu
=
"
mips64
"
+
target_cpu
=
"
mips64
"
current_os
=
"
linux
"
#
reclient
does
not
support
gcc
.
-
428
7
+
428
7
gcc_toolchain
(
"
mips64
"
)
{
clang_toolchain
(
"
clang_loong64
"
)
{
toolchain_args
=
{
-
current_cpu
=
"
loong64
"
+
target_cpu
=
"
loong64
"
current_os
=
"
linux
"
}
}
-
445
7
+
445
7
gcc_toolchain
(
"
loong64
"
)
{
ld
=
cxx
toolchain_args
=
{
-
current_cpu
=
"
loong64
"
+
target_cpu
=
"
loong64
"
current_os
=
"
linux
"
is_clang
=
false
}
diff
-
-
git
a
/
toolchain
/
linux
/
unbundle
/
BUILD
.
gn
b
/
toolchain
/
linux
/
unbundle
/
BUILD
.
gn
index
13c776f9f
.
.
aed67c6c1
100644
-
-
-
a
/
toolchain
/
linux
/
unbundle
/
BUILD
.
gn
+
+
+
b
/
toolchain
/
linux
/
unbundle
/
BUILD
.
gn
-
17
7
+
17
7
gcc_toolchain
(
"
default
"
)
{
extra_ldflags
=
getenv
(
"
LDFLAGS
"
)
toolchain_args
=
{
-
current_cpu
=
current_cpu
+
target_cpu
=
target_cpu
current_os
=
current_os
}
}
-
35
7
+
35
7
gcc_toolchain
(
"
host
"
)
{
extra_ldflags
=
getenv
(
"
BUILD_LDFLAGS
"
)
toolchain_args
=
{
-
current_cpu
=
current_cpu
+
target_cpu
=
target_cpu
current_os
=
current_os
}
}
diff
-
-
git
a
/
toolchain
/
mac
/
BUILD
.
gn
b
/
toolchain
/
mac
/
BUILD
.
gn
index
e2b188f9e
.
.
b531effd6
100644
-
-
-
a
/
toolchain
/
mac
/
BUILD
.
gn
+
+
+
b
/
toolchain
/
mac
/
BUILD
.
gn
-
44
74
+
44
74
template
(
"
mac_toolchain
"
)
{
mac_toolchain
(
"
clang_arm
"
)
{
toolchain_args
=
{
-
current_cpu
=
"
arm
"
+
target_cpu
=
"
arm
"
}
}
mac_toolchain
(
"
clang_arm64
"
)
{
toolchain_args
=
{
-
current_cpu
=
"
arm64
"
+
target_cpu
=
"
arm64
"
}
}
mac_toolchain
(
"
clang_x64
"
)
{
toolchain_args
=
{
-
current_cpu
=
"
x64
"
+
target_cpu
=
"
x64
"
}
}
mac_toolchain
(
"
clang_x86
"
)
{
toolchain_args
=
{
-
current_cpu
=
"
x86
"
+
target_cpu
=
"
x86
"
}
}
mac_toolchain
(
"
clang_x86_v8_arm
"
)
{
toolchain_args
=
{
-
current_cpu
=
"
x86
"
+
target_cpu
=
"
x86
"
-
if
(
defined
(
v8_current_cpu
)
)
{
-
v8_current_cpu
=
"
arm
"
+
if
(
defined
(
v8_target_cpu
)
)
{
+
v8_target_cpu
=
"
arm
"
}
}
}
mac_toolchain
(
"
clang_x86_v8_mipsel
"
)
{
toolchain_args
=
{
-
current_cpu
=
"
x86
"
+
target_cpu
=
"
x86
"
-
if
(
defined
(
v8_current_cpu
)
)
{
-
v8_current_cpu
=
"
mipsel
"
+
if
(
defined
(
v8_target_cpu
)
)
{
+
v8_target_cpu
=
"
mipsel
"
}
}
}
mac_toolchain
(
"
clang_x64_v8_arm64
"
)
{
toolchain_args
=
{
-
current_cpu
=
"
x64
"
+
target_cpu
=
"
x64
"
-
if
(
defined
(
v8_current_cpu
)
)
{
-
v8_current_cpu
=
"
arm64
"
+
if
(
defined
(
v8_target_cpu
)
)
{
+
v8_target_cpu
=
"
arm64
"
}
}
}
mac_toolchain
(
"
clang_x64_v8_mips64el
"
)
{
toolchain_args
=
{
-
current_cpu
=
"
x64
"
+
target_cpu
=
"
x64
"
-
if
(
defined
(
v8_current_cpu
)
)
{
-
v8_current_cpu
=
"
mips64el
"
+
if
(
defined
(
v8_target_cpu
)
)
{
+
v8_target_cpu
=
"
mips64el
"
}
}
}
mac_toolchain
(
"
clang_arm64_v8_x64
"
)
{
toolchain_args
=
{
-
current_cpu
=
"
arm64
"
+
target_cpu
=
"
arm64
"
-
if
(
defined
(
v8_current_cpu
)
)
{
-
v8_current_cpu
=
"
x64
"
+
if
(
defined
(
v8_target_cpu
)
)
{
+
v8_target_cpu
=
"
x64
"
}
}
}
diff
-
-
git
a
/
toolchain
/
nacl
/
BUILD
.
gn
b
/
toolchain
/
nacl
/
BUILD
.
gn
index
68960aa9d
.
.
256ec6ba5
100644
-
-
-
a
/
toolchain
/
nacl
/
BUILD
.
gn
+
+
+
b
/
toolchain
/
nacl
/
BUILD
.
gn
-
97
7
+
97
7
template
(
"
pnacl_toolchain
"
)
{
toolchain_args
=
{
is_clang
=
true
-
current_cpu
=
"
pnacl
"
+
target_cpu
=
"
pnacl
"
use_lld
=
false
}
}
-
147
7
+
147
7
template
(
"
nacl_glibc_toolchain
"
)
{
strip
=
toolprefix
+
"
strip
"
+
toolsuffix
toolchain_args
=
{
-
current_cpu
=
toolchain_cpu
+
target_cpu
=
toolchain_cpu
#
reclient
does
not
support
gcc
.
use_remoteexec
=
false
-
208
7
+
208
7
template
(
"
nacl_clang_toolchain
"
)
{
strip
=
toolprefix
+
"
strip
"
+
toolsuffix
toolchain_args
=
{
-
current_cpu
=
toolchain_cpu
+
target_cpu
=
toolchain_cpu
is_clang
=
true
use_lld
=
false
}
-
257
7
+
257
7
template
(
"
nacl_irt_toolchain
"
)
{
ld
=
"
{
python_path
}
{
link_irt
}
-
-
tls
-
edit
=
{
tls_edit
}
-
-
link
-
cmd
=
{
cxx
}
-
-
readelf
-
cmd
=
{
readelf
}
"
toolchain_args
=
{
-
current_cpu
=
toolchain_cpu
+
target_cpu
=
toolchain_cpu
is_clang
=
true
use_lld
=
false
is_nacl_saigo
=
use_saigo
diff
-
-
git
a
/
toolchain
/
win
/
BUILD
.
gn
b
/
toolchain
/
win
/
BUILD
.
gn
index
c76d6df05
.
.
b50216b49
100644
-
-
-
a
/
toolchain
/
win
/
BUILD
.
gn
+
+
+
b
/
toolchain
/
win
/
BUILD
.
gn
-
71
7
+
71
7
if
(
host_os
=
=
"
win
"
)
{
#
environment
:
File
name
of
environment
file
.
#
#
You
would
also
define
a
toolchain_args
variable
with
at
least
these
set
:
-
#
current_cpu
:
current_cpu
to
pass
as
a
build
arg
+
#
target_cpu
:
target_cpu
to
pass
as
a
build
arg
#
current_os
:
current_os
to
pass
as
a
build
arg
template
(
"
msvc_toolchain
"
)
{
toolchain
(
target_name
)
{
-
239
7
+
239
7
template
(
"
msvc_toolchain
"
)
{
tool
(
"
asm
"
)
{
is_msvc_assembler
=
true
-
if
(
toolchain_args
.
current_cpu
=
=
"
arm64
"
)
{
+
if
(
toolchain_args
.
target_cpu
=
=
"
arm64
"
)
{
if
(
is_clang
)
{
prefix
=
rebase_path
(
"
clang_base_path
/
bin
"
root_build_dir
)
ml
=
"
{
clang_prefix
}
{
prefix
}
/
{
clang_cl
}
-
-
target
=
arm64
-
windows
"
-
256
7
+
256
7
template
(
"
msvc_toolchain
"
)
{
}
}
else
{
#
x86
/
x64
builds
always
use
the
MSVC
assembler
.
-
if
(
toolchain_args
.
current_cpu
=
=
"
x64
"
)
{
+
if
(
toolchain_args
.
target_cpu
=
=
"
x64
"
)
{
ml
=
"
ml64
.
exe
"
}
else
{
ml
=
"
ml
.
exe
"
-
268
7
+
268
7
template
(
"
msvc_toolchain
"
)
{
#
Suppress
final
-
stage
linking
on
x64
/
x86
builds
.
(
Armasm64
does
not
#
require
/
c
because
it
doesn
'
t
support
linking
.
)
-
if
(
toolchain_args
.
current_cpu
!
=
"
arm64
"
)
{
+
if
(
toolchain_args
.
target_cpu
!
=
"
arm64
"
)
{
ml
+
=
"
/
c
"
}
if
(
use_lld
)
{
-
282
7
+
282
7
template
(
"
msvc_toolchain
"
)
{
ml
=
"
python_path
ml_py
ml
"
}
}
-
if
(
toolchain_args
.
current_cpu
!
=
"
arm64
"
|
|
is_clang
)
{
+
if
(
toolchain_args
.
target_cpu
!
=
"
arm64
"
|
|
is_clang
)
{
command
=
"
python_path
tool_wrapper_path
asm
-
wrapper
env
ml
{
{
defines
}
}
{
{
include_dirs
}
}
{
{
asmflags
}
}
{
{
source
}
}
"
}
else
{
#
armasm64
.
exe
does
not
support
definitions
passed
via
the
command
line
.
-
515
7
+
515
7
template
(
"
win_toolchains
"
)
{
is_clang
=
false
use_clang_coverage
=
false
current_os
=
"
win
"
-
current_cpu
=
"
arm64
"
+
target_cpu
=
"
arm64
"
}
}
}
-
547
7
+
547
7
template
(
"
win_toolchains
"
)
{
}
is_clang
=
true
current_os
=
"
win
"
-
current_cpu
=
"
arm64
"
+
target_cpu
=
"
arm64
"
}
}
}
-
603
7
+
603
7
if
(
target_os
=
=
"
winuwp
"
)
{
cl
=
"
{
goma_prefix
}
\
"
{
store_cpu_toolchain_data
.
vc_bin_dir
}
/
cl
.
exe
\
"
"
toolchain_args
=
{
current_os
=
"
winuwp
"
-
current_cpu
=
target_cpu
+
target_cpu
=
target_cpu
is_clang
=
false
}
}
diff
-
-
git
a
/
toolchain
/
win
/
midl
.
gni
b
/
toolchain
/
win
/
midl
.
gni
index
60fda3858
.
.
ebb60edfc
100644
-
-
-
a
/
toolchain
/
win
/
midl
.
gni
+
+
+
b
/
toolchain
/
win
/
midl
.
gni
-
145
13
+
145
13
template
(
"
midl
"
)
{
outputs
+
=
[
"
out_dir
/
proxy_file
"
]
}
-
if
(
current_cpu
=
=
"
x86
"
)
{
+
if
(
target_cpu
=
=
"
x86
"
)
{
win_tool_arch
=
"
environment
.
x86
"
idl_target_platform
=
"
win32
"
-
}
else
if
(
current_cpu
=
=
"
x64
"
)
{
+
}
else
if
(
target_cpu
=
=
"
x64
"
)
{
win_tool_arch
=
"
environment
.
x64
"
idl_target_platform
=
"
x64
"
-
}
else
if
(
current_cpu
=
=
"
arm64
"
)
{
+
}
else
if
(
target_cpu
=
=
"
arm64
"
)
{
win_tool_arch
=
"
environment
.
arm64
"
idl_target_platform
=
"
arm64
"
}
else
{
diff
-
-
git
a
/
toolchain
/
zos
/
BUILD
.
gn
b
/
toolchain
/
zos
/
BUILD
.
gn
index
ce902048a
.
.
6b37b723d
100644
-
-
-
a
/
toolchain
/
zos
/
BUILD
.
gn
+
+
+
b
/
toolchain
/
zos
/
BUILD
.
gn
-
14
7
+
14
7
toolchain
(
"
s390x
"
)
{
ld
=
cxx
toolchain_args
=
{
-
current_cpu
=
"
s390x
"
+
target_cpu
=
"
s390x
"
current_os
=
"
zos
"
}
diff
-
-
git
a
/
win
/
BUILD
.
gn
b
/
win
/
BUILD
.
gn
index
a3d0d0e9c
.
.
4b2123439
100644
-
-
-
a
/
win
/
BUILD
.
gn
+
+
+
b
/
win
/
BUILD
.
gn
-
36
7
+
36
7
if
(
is_win
)
{
"
root_out_dir
/
cdb
/
winxp
/
exts
.
dll
"
"
root_out_dir
/
cdb
/
winxp
/
ntsdexts
.
dll
"
]
-
if
(
current_cpu
!
=
"
arm64
"
)
{
+
if
(
target_cpu
!
=
"
arm64
"
)
{
#
The
UCRT
files
are
not
redistributable
for
ARM64
Win32
.
outputs
+
=
[
"
root_out_dir
/
cdb
/
api
-
ms
-
win
-
core
-
console
-
l1
-
1
-
0
.
dll
"
-
86
7
+
86
7
if
(
is_win
)
{
}
args
=
[
rebase_path
(
"
root_out_dir
/
cdb
"
root_out_dir
)
-
current_cpu
+
target_cpu
]
}
-
109
7
+
109
7
if
(
is_win
)
{
"
root_out_dir
/
vccorlib140
{
vcrt_suffix
}
.
dll
"
"
root_out_dir
/
vcruntime140
{
vcrt_suffix
}
.
dll
"
]
-
if
(
current_cpu
=
=
"
x64
"
)
{
+
if
(
target_cpu
=
=
"
x64
"
)
{
data
+
=
[
"
root_out_dir
/
vcruntime140_1
{
vcrt_suffix
}
.
dll
"
]
}
if
(
is_debug
)
{
-
120
7
+
120
7
if
(
is_win
)
{
"
ASan
is
only
supported
in
64
-
bit
builds
on
Windows
.
"
)
data
+
=
[
"
clang_base_path
/
lib
/
clang
/
clang_version
/
lib
/
windows
/
clang_rt
.
asan_dynamic
-
x86_64
.
dll
"
]
}
-
if
(
current_cpu
!
=
"
arm64
"
)
{
+
if
(
target_cpu
!
=
"
arm64
"
)
{
data
+
=
[
#
Universal
Windows
10
CRT
files
"
root_out_dir
/
api
-
ms
-
win
-
core
-
console
-
l1
-
1
-
0
.
dll
"
diff
-
-
git
a
/
win
/
message_compiler
.
gni
b
/
win
/
message_compiler
.
gni
index
06fbbd4ff
.
.
944d833a2
100644
-
-
-
a
/
win
/
message_compiler
.
gni
+
+
+
b
/
win
/
message_compiler
.
gni
-
50
7
+
50
7
template
(
"
message_compiler
"
)
{
#
directory
.
This
is
required
because
the
Windows
toolchain
setup
saves
#
the
VC
paths
and
such
so
that
running
"
mc
.
exe
"
will
work
with
the
#
configured
toolchain
.
This
file
is
in
the
root
build
dir
.
-
"
environment
.
current_cpu
"
+
"
environment
.
target_cpu
"
#
Where
to
put
the
header
.
"
-
h
"
