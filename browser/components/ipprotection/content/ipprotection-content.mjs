/
*
This
Source
Code
Form
is
subject
to
the
terms
of
the
Mozilla
Public
*
License
v
.
2
.
0
.
If
a
copy
of
the
MPL
was
not
distributed
with
this
*
file
You
can
obtain
one
at
https
:
/
/
mozilla
.
org
/
MPL
/
2
.
0
/
.
*
/
import
{
MozLitElement
}
from
"
chrome
:
/
/
global
/
content
/
lit
-
utils
.
mjs
"
;
import
{
html
}
from
"
chrome
:
/
/
global
/
content
/
vendor
/
lit
.
all
.
mjs
"
;
import
{
LINKS
ERRORS
}
from
"
chrome
:
/
/
browser
/
content
/
ipprotection
/
ipprotection
-
constants
.
mjs
"
;
/
/
eslint
-
disable
-
next
-
line
import
/
no
-
unassigned
-
import
import
"
chrome
:
/
/
browser
/
content
/
ipprotection
/
ipprotection
-
header
.
mjs
"
;
/
/
eslint
-
disable
-
next
-
line
import
/
no
-
unassigned
-
import
import
"
chrome
:
/
/
browser
/
content
/
ipprotection
/
ipprotection
-
flag
.
mjs
"
;
/
/
eslint
-
disable
-
next
-
line
import
/
no
-
unassigned
-
import
import
"
chrome
:
/
/
browser
/
content
/
ipprotection
/
ipprotection
-
message
-
bar
.
mjs
"
;
/
/
eslint
-
disable
-
next
-
line
import
/
no
-
unassigned
-
import
import
"
chrome
:
/
/
browser
/
content
/
ipprotection
/
ipprotection
-
signedout
.
mjs
"
;
/
/
eslint
-
disable
-
next
-
line
import
/
no
-
unassigned
-
import
import
"
chrome
:
/
/
browser
/
content
/
ipprotection
/
ipprotection
-
status
-
card
.
mjs
"
;
/
/
eslint
-
disable
-
next
-
line
import
/
no
-
unassigned
-
import
import
"
chrome
:
/
/
global
/
content
/
elements
/
moz
-
toggle
.
mjs
"
;
/
*
*
*
Custom
element
that
implements
a
message
bar
and
status
card
for
IP
protection
.
*
/
export
default
class
IPProtectionContentElement
extends
MozLitElement
{
static
queries
=
{
headerEl
:
"
ipprotection
-
header
"
signedOutEl
:
"
ipprotection
-
signedout
"
messagebarEl
:
"
ipprotection
-
message
-
bar
"
statusCardEl
:
"
ipprotection
-
status
-
card
"
upgradeEl
:
"
#
upgrade
-
vpn
-
content
"
activeSubscriptionEl
:
"
#
active
-
subscription
-
vpn
-
content
"
supportLinkEl
:
"
#
vpn
-
support
-
link
"
}
;
static
properties
=
{
state
:
{
type
:
Object
attribute
:
false
}
_showMessageBar
:
{
type
:
Boolean
state
:
true
}
_messageDismissed
:
{
type
:
Boolean
state
:
true
}
}
;
constructor
(
)
{
super
(
)
;
this
.
state
=
{
}
;
this
.
keyListener
=
this
.
#
keyListener
.
bind
(
this
)
;
this
.
messageBarListener
=
this
.
#
messageBarListener
.
bind
(
this
)
;
this
.
toggleListener
=
this
.
#
toggleEventListener
.
bind
(
this
)
;
this
.
_showMessageBar
=
false
;
this
.
_messageDismissed
=
false
;
}
connectedCallback
(
)
{
super
.
connectedCallback
(
)
;
this
.
dispatchEvent
(
new
CustomEvent
(
"
IPProtection
:
Init
"
{
bubbles
:
true
}
)
)
;
this
.
addEventListener
(
"
keydown
"
this
.
keyListener
{
capture
:
true
}
)
;
this
.
addEventListener
(
"
ipprotection
-
status
-
card
:
user
-
toggled
-
on
"
this
.
#
toggleEventListener
)
;
this
.
addEventListener
(
"
ipprotection
-
status
-
card
:
user
-
toggled
-
off
"
this
.
#
toggleEventListener
)
;
this
.
addEventListener
(
"
ipprotection
-
message
-
bar
:
user
-
dismissed
"
this
.
#
messageBarListener
)
;
}
disconnectedCallback
(
)
{
super
.
disconnectedCallback
(
)
;
this
.
removeEventListener
(
"
keydown
"
this
.
keyListener
{
capture
:
true
}
)
;
this
.
removeEventListener
(
"
ipprotection
-
status
-
card
:
user
-
toggled
-
on
"
this
.
#
toggleEventListener
)
;
this
.
removeEventListener
(
"
ipprotection
-
status
-
card
:
user
-
toggled
-
off
"
this
.
#
toggleEventListener
)
;
this
.
removeEventListener
(
"
ipprotection
-
message
-
bar
:
user
-
dismissed
"
this
.
#
messageBarListener
)
;
}
get
canShowConnectionTime
(
)
{
return
(
this
.
state
&
&
this
.
state
.
isProtectionEnabled
&
&
this
.
state
.
protectionEnabledSince
&
&
!
this
.
state
.
isSignedOut
)
;
}
get
canEnableConnection
(
)
{
return
this
.
state
&
&
this
.
state
.
isProtectionEnabled
&
&
!
this
.
state
.
error
;
}
get
#
hasErrors
(
)
{
return
!
this
.
state
|
|
this
.
state
.
error
!
=
=
"
"
;
}
handleClickSupportLink
(
event
)
{
const
win
=
event
.
target
.
ownerGlobal
;
if
(
event
.
target
=
=
=
this
.
supportLinkEl
)
{
event
.
preventDefault
(
)
;
win
.
openWebLinkIn
(
LINKS
.
PRODUCT_URL
"
tab
"
)
;
this
.
dispatchEvent
(
new
CustomEvent
(
"
IPProtection
:
Close
"
{
bubbles
:
true
}
)
)
;
}
}
handleUpgrade
(
event
)
{
const
win
=
event
.
target
.
ownerGlobal
;
win
.
openWebLinkIn
(
LINKS
.
PRODUCT_URL
+
"
#
pricing
"
"
tab
"
)
;
/
/
Close
the
panel
this
.
dispatchEvent
(
new
CustomEvent
(
"
IPProtection
:
ClickUpgrade
"
{
bubbles
:
true
}
)
)
;
Glean
.
ipprotection
.
clickUpgradeButton
.
record
(
)
;
}
focus
(
)
{
if
(
this
.
state
.
isSignedOut
)
{
this
.
signedOutEl
?
.
focus
(
)
;
}
else
{
this
.
statusCardEl
?
.
focus
(
)
;
}
}
#
keyListener
(
event
)
{
let
keyCode
=
event
.
code
;
switch
(
keyCode
)
{
case
"
ArrowUp
"
:
/
/
Intentional
fall
-
through
case
"
ArrowDown
"
:
{
event
.
stopPropagation
(
)
;
event
.
preventDefault
(
)
;
let
direction
=
keyCode
=
=
"
ArrowDown
"
?
Services
.
focus
.
MOVEFOCUS_FORWARD
:
Services
.
focus
.
MOVEFOCUS_BACKWARD
;
Services
.
focus
.
moveFocus
(
window
null
direction
Services
.
focus
.
FLAG_BYKEY
)
;
break
;
}
}
}
#
toggleEventListener
(
event
)
{
if
(
event
.
type
=
=
=
"
ipprotection
-
status
-
card
:
user
-
toggled
-
on
"
)
{
this
.
dispatchEvent
(
new
CustomEvent
(
"
IPProtection
:
UserEnable
"
{
bubbles
:
true
}
)
)
;
}
else
if
(
event
.
type
=
=
=
"
ipprotection
-
status
-
card
:
user
-
toggled
-
off
"
)
{
this
.
dispatchEvent
(
new
CustomEvent
(
"
IPProtection
:
UserDisable
"
{
bubbles
:
true
}
)
)
;
}
}
#
messageBarListener
(
event
)
{
if
(
event
.
type
=
=
=
"
ipprotection
-
message
-
bar
:
user
-
dismissed
"
)
{
this
.
_showMessageBar
=
false
;
this
.
_messageDismissed
=
true
;
this
.
state
.
error
=
"
"
;
}
}
updated
(
changedProperties
)
{
super
.
updated
(
changedProperties
)
;
/
/
Clear
messages
when
there
is
an
error
.
if
(
this
.
state
.
error
)
{
this
.
_messageDismissed
=
false
;
}
}
messageBarTemplate
(
)
{
/
/
TODO
:
Set
messageId
based
on
state
in
Bug
1997328
return
html
<
ipprotection
-
message
-
bar
class
=
"
vpn
-
top
-
content
"
type
=
{
this
.
#
hasErrors
?
ERRORS
.
GENERIC
:
"
info
"
}
messageId
=
"
ipprotection
-
message
-
continuous
-
onboarding
-
1
"
>
<
/
ipprotection
-
message
-
bar
>
;
}
descriptionTemplate
(
)
{
return
this
.
state
.
location
?
html
<
ipprotection
-
flag
.
location
=
{
this
.
state
.
location
}
>
<
/
ipprotection
-
flag
>
:
null
;
}
statusCardTemplate
(
)
{
return
html
<
ipprotection
-
status
-
card
.
protectionEnabled
=
{
this
.
canEnableConnection
}
.
canShowTime
=
{
this
.
canShowConnectionTime
}
.
enabledSince
=
{
this
.
state
.
protectionEnabledSince
}
.
location
=
{
this
.
state
.
location
}
>
<
/
ipprotection
-
status
-
card
>
;
}
beforeUpgradeTemplate
(
)
{
return
html
<
div
id
=
"
upgrade
-
vpn
-
content
"
class
=
"
vpn
-
bottom
-
content
"
>
<
h2
id
=
"
upgrade
-
vpn
-
title
"
data
-
l10n
-
id
=
"
upgrade
-
vpn
-
title
"
class
=
"
vpn
-
subtitle
"
>
<
/
h2
>
<
p
id
=
"
upgrade
-
vpn
-
paragraph
"
data
-
l10n
-
id
=
"
upgrade
-
vpn
-
paragraph
"
click
=
{
this
.
handleClickSupportLink
}
>
<
a
id
=
"
vpn
-
support
-
link
"
href
=
{
LINKS
.
PRODUCT_URL
}
data
-
l10n
-
name
=
"
learn
-
more
-
vpn
"
>
<
/
a
>
<
/
p
>
<
moz
-
button
id
=
"
upgrade
-
vpn
-
button
"
class
=
"
vpn
-
button
"
click
=
{
this
.
handleUpgrade
}
type
=
"
secondary
"
data
-
l10n
-
id
=
"
upgrade
-
vpn
-
button
"
>
<
/
moz
-
button
>
<
/
div
>
;
}
mainContentTemplate
(
)
{
/
/
TODO
:
Update
support
-
page
with
new
SUMO
link
for
Mozilla
VPN
-
Bug
1975474
if
(
this
.
state
.
isSignedOut
)
{
return
html
<
ipprotection
-
signedout
>
<
/
ipprotection
-
signedout
>
;
}
return
html
{
this
.
statusCardTemplate
(
)
}
{
!
this
.
state
.
hasUpgraded
?
this
.
beforeUpgradeTemplate
(
)
:
null
}
;
}
render
(
)
{
/
/
TODO
:
Set
showContinuousOnboarding
based
on
state
Bug
1997328
if
(
(
this
.
#
hasErrors
|
|
this
.
showContinuousOnboarding
)
&
&
!
this
.
_messageDismissed
)
{
this
.
_showMessageBar
=
true
;
}
const
messageBar
=
this
.
_showMessageBar
?
this
.
messageBarTemplate
(
)
:
null
;
/
/
TODO
:
Check
state
to
determine
what
position
to
add
the
message
bar
Bug
1997328
const
content
=
html
{
messageBar
}
{
this
.
mainContentTemplate
(
)
}
;
/
/
TODO
:
Conditionally
render
post
-
upgrade
subview
within
#
ipprotection
-
content
-
wrapper
-
Bug
1973813
return
html
<
link
rel
=
"
stylesheet
"
href
=
"
chrome
:
/
/
browser
/
content
/
ipprotection
/
ipprotection
-
content
.
css
"
/
>
<
ipprotection
-
header
titleId
=
"
ipprotection
-
title
"
>
<
/
ipprotection
-
header
>
<
hr
/
>
<
div
id
=
"
ipprotection
-
content
-
wrapper
"
>
{
content
}
<
/
div
>
;
}
}
customElements
.
define
(
"
ipprotection
-
content
"
IPProtectionContentElement
)
;
