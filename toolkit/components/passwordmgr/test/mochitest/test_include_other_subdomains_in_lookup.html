<
!
DOCTYPE
HTML
>
<
html
>
<
head
>
<
meta
charset
=
"
utf
-
8
"
>
<
title
>
Test
includeOtherSubdomainsInLookup
<
/
title
>
<
script
type
=
"
text
/
javascript
"
src
=
"
/
tests
/
SimpleTest
/
SimpleTest
.
js
"
>
<
/
script
>
<
script
type
=
"
text
/
javascript
"
src
=
"
/
tests
/
SimpleTest
/
EventUtils
.
js
"
>
<
/
script
>
<
script
type
=
"
text
/
javascript
"
src
=
"
.
.
/
.
.
/
.
.
/
satchel
/
test
/
satchel_common
.
js
"
>
<
/
script
>
<
script
type
=
"
text
/
javascript
"
src
=
"
pwmgr_common
.
js
"
>
<
/
script
>
<
link
rel
=
"
stylesheet
"
type
=
"
text
/
css
"
href
=
"
/
tests
/
SimpleTest
/
test
.
css
"
/
>
<
/
head
>
<
body
>
<
p
id
=
"
display
"
>
<
/
p
>
<
div
id
=
"
content
"
>
<
/
div
>
<
pre
id
=
"
test
"
>
Test
that
logins
with
non
-
exact
match
origin
appear
in
autocomplete
dropdown
.
The
includeOtherSubdomainsInLookup
feature
offers
autocomplete
results
for
subdomain
related
logins
.
For
this
testcase
there
exists
two
logins
for
this
origin
on
different
subdomains
(
old
.
example
.
com
and
new
.
example
.
com
)
but
with
different
passwords
beneath
one
login
for
the
parent
domain
(
example
.
com
)
.
Both
logins
should
appear
in
the
autocomplete
popup
.
<
template
id
=
"
form1
-
template
"
>
<
form
id
=
"
form1
"
action
=
"
https
:
/
/
otherexample
.
com
/
formtest
.
js
"
>
<
input
type
=
"
text
"
name
=
"
uname
"
>
<
input
type
=
"
password
"
name
=
"
pword
"
>
<
/
form
>
<
/
template
>
<
script
class
=
"
testbody
"
type
=
"
text
/
javascript
"
>
const
formTemplate
=
document
.
getElementById
(
"
form1
-
template
"
)
;
const
loginInfos
=
[
[
"
https
:
/
/
example
.
com
/
"
"
https
:
/
/
example
.
com
/
"
null
"
example
-
user
"
"
example
-
password
"
"
uname
"
"
pword
"
]
[
"
https
:
/
/
old
.
example
.
com
/
"
"
https
:
/
/
old
.
example
.
com
/
"
null
"
example
-
user
"
"
example
-
password
"
"
uname
"
"
pword
"
]
[
"
https
:
/
/
new
.
example
.
com
/
"
"
https
:
/
/
new
.
example
.
com
/
"
null
"
example
-
user
"
"
new
-
example
-
password
"
"
uname
"
"
pword
"
]
]
;
/
/
TODO
:
explain
why
we
need
to
run
this
in
parent
const
getDateString
=
(
(
)
=
>
{
const
setupScript
=
runInParent
(
function
setup
(
)
{
addMessageListener
(
"
getDateString
"
(
)
=
>
{
const
dateAndTimeFormatter
=
new
Services
.
intl
.
DateTimeFormat
(
undefined
{
dateStyle
:
"
medium
"
}
)
;
return
dateAndTimeFormatter
.
format
(
new
Date
(
)
)
;
}
)
;
}
)
;
return
(
)
=
>
setupScript
.
sendQuery
(
"
getDateString
"
)
;
}
)
(
)
;
add_setup
(
async
(
)
=
>
{
listenForUnexpectedPopupShown
(
)
;
}
)
;
/
/
TODO
:
explain
add_named_task
(
"
when
includeOtherSubdomainsInLookup
is
false
and
there
are
no
http
-
logins
do
not
show
autocomplete
popup
"
async
(
)
=
>
{
await
setPreferencesForTask
(
[
"
signon
.
includeOtherSubdomainsInLookup
"
false
]
)
;
await
setStoredLoginsDuringTask
(
.
.
.
loginInfos
)
;
const
form
=
setContentForTask
(
formTemplate
)
;
form
.
uname
.
focus
(
)
;
await
noPopupByArrowDown
(
)
;
ok
(
true
"
no
popup
has
been
opened
"
)
}
)
;
add_named_task
(
"
menu
does
not
show
login
for
different
subdomain
when
includeOtherSubdomainsInLookup
is
false
"
async
(
)
=
>
{
await
setPreferencesForTask
(
[
"
signon
.
includeOtherSubdomainsInLookup
"
false
]
)
;
await
setStoredLoginsDuringTask
(
.
.
.
[
/
/
These
two
logins
should
never
be
visible
on
https
:
versions
of
/
/
*
.
example
.
com
since
the
login
is
for
http
:
and
an
https
:
login
exists
for
this
username
.
/
/
eslint
-
disable
-
next
-
line
microsoft
/
sdl
/
no
-
insecure
-
url
[
"
http
:
/
/
example
.
com
/
"
"
https
:
/
/
example
.
com
/
"
null
"
example
-
user
"
"
example
-
password
"
"
uname
"
"
pword
"
]
/
/
eslint
-
disable
-
next
-
line
microsoft
/
sdl
/
no
-
insecure
-
url
[
"
http
:
/
/
old
.
example
.
com
/
"
"
https
:
/
/
old
.
example
.
com
/
"
null
"
example
-
user
"
"
old
-
example
-
password
"
"
uname
"
"
pword
"
]
.
.
.
loginInfos
]
)
;
const
form
=
setContentForTask
(
formTemplate
)
;
form
.
uname
.
focus
(
)
;
const
autocompleteItems
=
await
popupByArrowDown
(
)
;
checkAutoCompleteResults
(
autocompleteItems
[
"
example
-
user
"
]
window
.
location
.
host
"
Only
exact
subdomain
showed
"
)
;
}
)
;
add_named_task
(
"
menu
shows
two
logins
with
the
same
username
for
different
subdomain
"
async
(
)
=
>
{
await
setStoredLoginsDuringTask
(
.
.
.
loginInfos
)
;
await
setPreferencesForTask
(
[
"
signon
.
includeOtherSubdomainsInLookup
"
true
]
)
;
const
form
=
setContentForTask
(
formTemplate
)
;
/
/
The
logins
are
added
"
today
"
and
since
they
are
duplicates
the
date
that
they
were
last
/
/
changed
will
be
appended
.
const
dateString
=
await
getDateString
(
)
;
const
username
=
example
-
user
(
{
dateString
}
)
;
form
.
uname
.
focus
(
)
;
const
autocompleteItems
=
await
popupByArrowDown
(
)
;
checkAutoCompleteResults
(
autocompleteItems
[
username
username
]
window
.
location
.
host
"
Check
all
menuitems
are
displayed
correctly
.
"
)
;
}
)
;
add_named_task
(
"
login
with
different
subdomain
is
selectable
"
async
(
)
=
>
{
await
setPreferencesForTask
(
[
"
signon
.
includeOtherSubdomainsInLookup
"
true
]
)
;
await
setStoredLoginsDuringTask
(
.
.
.
loginInfos
)
;
const
form
=
setContentForTask
(
formTemplate
)
;
/
/
consume
initial
autofill
event
await
formAutofillResult
(
form
.
id
)
;
form
.
uname
.
focus
(
)
;
/
/
select
first
item
await
popupByArrowDown
(
)
;
synthesizeKey
(
"
KEY_ArrowDown
"
)
;
synthesizeKey
(
"
KEY_Enter
"
)
;
await
formAutofillResult
(
form
.
id
)
;
is
(
form
.
uname
.
value
"
example
-
user
"
"
correct
username
is
set
"
)
;
is
(
form
.
pword
.
value
"
example
-
password
"
"
password
matches
first
login
"
)
;
/
/
select
second
item
await
popupByArrowDown
(
)
;
synthesizeKey
(
"
KEY_ArrowDown
"
)
;
synthesizeKey
(
"
KEY_ArrowDown
"
)
;
synthesizeKey
(
"
KEY_Enter
"
)
;
await
formAutofillResult
(
form
.
id
)
;
is
(
form
.
uname
.
value
"
example
-
user
"
"
correct
username
is
set
"
)
;
is
(
form
.
pword
.
value
"
new
-
example
-
password
"
"
password
matches
second
login
"
)
;
}
)
;
<
/
script
>
<
/
pre
>
<
/
body
>
<
/
html
>
